
var CryptoJS=CryptoJS||(function(Math,undefined){var C={};var C_lib=C.lib={};var Base=C_lib.Base=(function(){function F(){}
return{extend:function(overrides){F.prototype=this;var subtype=new F();if(overrides){subtype.mixIn(overrides);}
subtype.$super=this;return subtype;},create:function(){var instance=this.extend();instance.init.apply(instance,arguments);return instance;},init:function(){},mixIn:function(properties){for(var propertyName in properties){if(properties.hasOwnProperty(propertyName)){this[propertyName]=properties[propertyName];}}
if(properties.hasOwnProperty('toString')){this.toString=properties.toString;}},clone:function(){return this.$super.extend(this);}};}());var WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes;}else{this.sigBytes=words.length*4;}},toString:function(encoder){return(encoder||Hex).stringify(this);},concat:function(wordArray){var thisWords=this.words;var thatWords=wordArray.words;var thisSigBytes=this.sigBytes;var thatSigBytes=wordArray.sigBytes;this.clamp();if(thisSigBytes%4){for(var i=0;i<thatSigBytes;i++){var thatByte=(thatWords[i>>>2]>>>(24-(i%4)*8))&0xff;thisWords[(thisSigBytes+i)>>>2]|=thatByte<<(24-((thisSigBytes+i)%4)*8);}}else if(thatWords.length>0xffff){for(var i=0;i<thatSigBytes;i+=4){thisWords[(thisSigBytes+i)>>>2]=thatWords[i>>>2];}}else{thisWords.push.apply(thisWords,thatWords);}
this.sigBytes+=thatSigBytes;return this;},clamp:function(){var words=this.words;var sigBytes=this.sigBytes;words[sigBytes>>>2]&=0xffffffff<<(32-(sigBytes%4)*8);words.length=Math.ceil(sigBytes/4);},clone:function(){var clone=Base.clone.call(this);clone.words=this.words.slice(0);return clone;},random:function(nBytes){var words=[];for(var i=0;i<nBytes;i+=4){words.push((Math.random()*0x100000000)|0);}
return WordArray.create(words,nBytes);}});var C_enc=C.enc={};var Hex=C_enc.Hex={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var hexChars=[];for(var i=0;i<sigBytes;i++){var bite=(words[i>>>2]>>>(24-(i%4)*8))&0xff;hexChars.push((bite>>>4).toString(16));hexChars.push((bite&0x0f).toString(16));}
return hexChars.join('');},parse:function(hexStr){var hexStrLength=hexStr.length;var words=[];for(var i=0;i<hexStrLength;i+=2){words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<(24-(i%8)*4);}
return WordArray.create(words,hexStrLength/2);}};var Latin1=C_enc.Latin1={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var latin1Chars=[];for(var i=0;i<sigBytes;i++){var bite=(words[i>>>2]>>>(24-(i%4)*8))&0xff;latin1Chars.push(String.fromCharCode(bite));}
return latin1Chars.join('');},parse:function(latin1Str){var latin1StrLength=latin1Str.length;var words=[];for(var i=0;i<latin1StrLength;i++){words[i>>>2]|=(latin1Str.charCodeAt(i)&0xff)<<(24-(i%4)*8);}
return WordArray.create(words,latin1StrLength);}};var Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)));}catch(e){throw new Error('Malformed UTF-8 data');}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)));}};var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=WordArray.create();this._nDataBytes=0;},_append:function(data){if(typeof data=='string'){data=Utf8.parse(data);}
this._data.concat(data);this._nDataBytes+=data.sigBytes;},_process:function(flush){var data=this._data;var dataWords=data.words;var dataSigBytes=data.sigBytes;var blockSize=this.blockSize;var blockSizeBytes=blockSize*4;var nBlocksReady=dataSigBytes/blockSizeBytes;if(flush){nBlocksReady=Math.ceil(nBlocksReady);}else{nBlocksReady=Math.max((nBlocksReady|0)-this._minBufferSize,0);}
var nWordsReady=nBlocksReady*blockSize;var nBytesReady=Math.min(nWordsReady*4,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize){this._doProcessBlock(dataWords,offset);}
var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady;}
return WordArray.create(processedWords,nBytesReady);},clone:function(){var clone=Base.clone.call(this);clone._data=this._data.clone();return clone;},_minBufferSize:0});var Hasher=C_lib.Hasher=BufferedBlockAlgorithm.extend({init:function(cfg){this.reset();},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset();},update:function(messageUpdate){this._append(messageUpdate);this._process();return this;},finalize:function(messageUpdate){if(messageUpdate){this._append(messageUpdate);}
this._doFinalize();return this._hash;},clone:function(){var clone=BufferedBlockAlgorithm.clone.call(this);clone._hash=this._hash.clone();return clone;},blockSize:512/32,_createHelper:function(hasher){return function(message,cfg){return hasher.create(cfg).finalize(message);};},_createHmacHelper:function(hasher){return function(message,key){return C_algo.HMAC.create(hasher,key).finalize(message);};}});var C_algo=C.algo={};return C;}(Math));
CryptoJS.lib.Cipher||(function(undefined){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var WordArray=C_lib.WordArray;var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm;var C_enc=C.enc;var Utf8=C_enc.Utf8;var Base64=C_enc.Base64;var C_algo=C.algo;var EvpKDF=C_algo.EvpKDF;var Cipher=C_lib.Cipher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),createEncryptor:function(key,cfg){return this.create(this._ENC_XFORM_MODE,key,cfg);},createDecryptor:function(key,cfg){return this.create(this._DEC_XFORM_MODE,key,cfg);},init:function(xformMode,key,cfg){this.cfg=this.cfg.extend(cfg);this._xformMode=xformMode;this._key=key;this.reset();},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset();},process:function(dataUpdate){this._append(dataUpdate);return this._process();},finalize:function(dataUpdate){if(dataUpdate){this._append(dataUpdate);}
var finalProcessedData=this._doFinalize();return finalProcessedData;},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function selectCipherStrategy(key){if(typeof key=='string'){return PasswordBasedCipher;}else{return SerializableCipher;}}
return function(cipher){return{encrypt:function(message,key,cfg){return selectCipherStrategy(key).encrypt(cipher,message,key,cfg);},decrypt:function(ciphertext,key,cfg){return selectCipherStrategy(key).decrypt(cipher,ciphertext,key,cfg);}};};}())});var StreamCipher=C_lib.StreamCipher=Cipher.extend({_doFinalize:function(){var finalProcessedBlocks=this._process(!!'flush');return finalProcessedBlocks;},blockSize:1});var C_mode=C.mode={};var BlockCipherMode=C_lib.BlockCipherMode=Base.extend({createEncryptor:function(cipher,iv){return this.Encryptor.create(cipher,iv);},createDecryptor:function(cipher,iv){return this.Decryptor.create(cipher,iv);},init:function(cipher,iv){this._cipher=cipher;this._iv=iv;}});var CBC=C_mode.CBC=(function(){var CBC=BlockCipherMode.extend();CBC.Encryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;xorBlock.call(this,words,offset,blockSize);cipher.encryptBlock(words,offset);this._prevBlock=words.slice(offset,offset+blockSize);}});CBC.Decryptor=CBC.extend({processBlock:function(words,offset){var cipher=this._cipher;var blockSize=cipher.blockSize;var thisBlock=words.slice(offset,offset+blockSize);cipher.decryptBlock(words,offset);xorBlock.call(this,words,offset,blockSize);this._prevBlock=thisBlock;}});function xorBlock(words,offset,blockSize){var iv=this._iv;if(iv){var block=iv;this._iv=undefined;}else{var block=this._prevBlock;}
for(var i=0;i<blockSize;i++){words[offset+i]^=block[i];}}
return CBC;}());var C_pad=C.pad={};var Pkcs7=C_pad.Pkcs7={pad:function(data,blockSize){var blockSizeBytes=blockSize*4;var nPaddingBytes=blockSizeBytes-data.sigBytes%blockSizeBytes;var paddingWord=(nPaddingBytes<<24)|(nPaddingBytes<<16)|(nPaddingBytes<<8)|nPaddingBytes;var paddingWords=[];for(var i=0;i<nPaddingBytes;i+=4){paddingWords.push(paddingWord);}
var padding=WordArray.create(paddingWords,nPaddingBytes);data.concat(padding);},unpad:function(data){var nPaddingBytes=data.words[(data.sigBytes-1)>>>2]&0xff;data.sigBytes-=nPaddingBytes;}};var BlockCipher=C_lib.BlockCipher=Cipher.extend({cfg:Cipher.cfg.extend({mode:CBC,padding:Pkcs7}),reset:function(){Cipher.reset.call(this);var cfg=this.cfg;var iv=cfg.iv;var mode=cfg.mode;if(this._xformMode==this._ENC_XFORM_MODE){var modeCreator=mode.createEncryptor;}else{var modeCreator=mode.createDecryptor;this._minBufferSize=1;}
this._mode=modeCreator.call(mode,this,iv&&iv.words);},_doProcessBlock:function(words,offset){this._mode.processBlock(words,offset);},_doFinalize:function(){var padding=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){padding.pad(this._data,this.blockSize);var finalProcessedBlocks=this._process(!!'flush');}else{var finalProcessedBlocks=this._process(!!'flush');padding.unpad(finalProcessedBlocks);}
return finalProcessedBlocks;},blockSize:128/32});var CipherParams=C_lib.CipherParams=Base.extend({init:function(cipherParams){this.mixIn(cipherParams);},toString:function(formatter){return(formatter||this.formatter).stringify(this);}});var C_format=C.format={};var OpenSSLFormatter=C_format.OpenSSL={stringify:function(cipherParams){var ciphertext=cipherParams.ciphertext;var salt=cipherParams.salt;if(salt){var wordArray=WordArray.create([0x53616c74,0x65645f5f]).concat(salt).concat(ciphertext);}else{var wordArray=ciphertext;}
var openSSLStr=wordArray.toString(Base64);openSSLStr=openSSLStr.replace(/(.{64})/g,'$1\n');return openSSLStr;},parse:function(openSSLStr){var ciphertext=Base64.parse(openSSLStr);var ciphertextWords=ciphertext.words;if(ciphertextWords[0]==0x53616c74&&ciphertextWords[1]==0x65645f5f){var salt=WordArray.create(ciphertextWords.slice(2,4));ciphertextWords.splice(0,4);ciphertext.sigBytes-=16;}
return CipherParams.create({ciphertext:ciphertext,salt:salt});}};var SerializableCipher=C_lib.SerializableCipher=Base.extend({cfg:Base.extend({format:OpenSSLFormatter}),encrypt:function(cipher,message,key,cfg){cfg=this.cfg.extend(cfg);var encryptor=cipher.createEncryptor(key,cfg);var ciphertext=encryptor.finalize(message);var cipherCfg=encryptor.cfg;return CipherParams.create({ciphertext:ciphertext,key:key,iv:cipherCfg.iv,algorithm:cipher,mode:cipherCfg.mode,padding:cipherCfg.padding,blockSize:cipher.blockSize,formatter:cfg.format});},decrypt:function(cipher,ciphertext,key,cfg){cfg=this.cfg.extend(cfg);ciphertext=this._parse(ciphertext,cfg.format);var plaintext=cipher.createDecryptor(key,cfg).finalize(ciphertext.ciphertext);return plaintext;},_parse:function(ciphertext,format){if(typeof ciphertext=='string'){return format.parse(ciphertext);}else{return ciphertext;}}});var C_kdf=C.kdf={};var OpenSSLKdf=C_kdf.OpenSSL={compute:function(password,keySize,ivSize,salt){if(!salt){salt=WordArray.random(64/8);}
var key=EvpKDF.create({keySize:keySize+ivSize}).compute(password,salt);var iv=WordArray.create(key.words.slice(keySize),ivSize*4);key.sigBytes=keySize*4;return CipherParams.create({key:key,iv:iv,salt:salt});}};var PasswordBasedCipher=C_lib.PasswordBasedCipher=SerializableCipher.extend({cfg:SerializableCipher.cfg.extend({kdf:OpenSSLKdf}),encrypt:function(cipher,message,password,cfg){cfg=this.cfg.extend(cfg);var derivedParams=cfg.kdf.compute(password,cipher.keySize,cipher.ivSize);cfg.iv=derivedParams.iv;var ciphertext=SerializableCipher.encrypt.call(this,cipher,message,derivedParams.key,cfg);ciphertext.mixIn(derivedParams);return ciphertext;},decrypt:function(cipher,ciphertext,password,cfg){cfg=this.cfg.extend(cfg);ciphertext=this._parse(ciphertext,cfg.format);var derivedParams=cfg.kdf.compute(password,cipher.keySize,cipher.ivSize,ciphertext.salt);cfg.iv=derivedParams.iv;var plaintext=SerializableCipher.decrypt.call(this,cipher,ciphertext,derivedParams.key,cfg);return plaintext;}});}());
(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var C_enc=C.enc;var Base64=C_enc.Base64={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var map=this._map;wordArray.clamp();var base64Chars=[];for(var i=0;i<sigBytes;i+=3){var byte1=(words[i>>>2]>>>(24-(i%4)*8))&0xff;var byte2=(words[(i+1)>>>2]>>>(24-((i+1)%4)*8))&0xff;var byte3=(words[(i+2)>>>2]>>>(24-((i+2)%4)*8))&0xff;var triplet=(byte1<<16)|(byte2<<8)|byte3;for(var j=0;(j<4)&&(i+j*0.75<sigBytes);j++){base64Chars.push(map.charAt((triplet>>>(6*(3-j)))&0x3f));}}
var paddingChar=map.charAt(64);if(paddingChar){while(base64Chars.length%4){base64Chars.push(paddingChar);}}
return base64Chars.join('');},parse:function(base64Str){base64Str=base64Str.replace(/\s/g,'');var base64StrLength=base64Str.length;var map=this._map;var paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);if(paddingIndex!=-1){base64StrLength=paddingIndex;}}
var words=[];var nBytes=0;for(var i=0;i<base64StrLength;i++){if(i%4){var bitsHigh=map.indexOf(base64Str.charAt(i-1))<<((i%4)*2);var bitsLow=map.indexOf(base64Str.charAt(i))>>>(6-(i%4)*2);words[nBytes>>>2]|=(bitsHigh|bitsLow)<<(24-(nBytes%4)*8);nBytes++;}}
return WordArray.create(words,nBytes);},_map:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='};}());
(function(){var C=CryptoJS;var C_lib=C.lib;var BlockCipher=C_lib.BlockCipher;var C_algo=C.algo;var SBOX=[];var INV_SBOX=[];var SUB_MIX_0=[];var SUB_MIX_1=[];var SUB_MIX_2=[];var SUB_MIX_3=[];var INV_SUB_MIX_0=[];var INV_SUB_MIX_1=[];var INV_SUB_MIX_2=[];var INV_SUB_MIX_3=[];(function(){var d=[];for(var i=0;i<256;i++){if(i<128){d[i]=i<<1;}else{d[i]=(i<<1)^0x11b;}}
var x=0;var xi=0;for(var i=0;i<256;i++){var sx=xi^(xi<<1)^(xi<<2)^(xi<<3)^(xi<<4);sx=(sx>>>8)^(sx&0xff)^0x63;SBOX[x]=sx;INV_SBOX[sx]=x;var x2=d[x];var x4=d[x2];var x8=d[x4];var t=(d[sx]*0x101)^(sx*0x1010100);SUB_MIX_0[x]=(t<<24)|(t>>>8);SUB_MIX_1[x]=(t<<16)|(t>>>16);SUB_MIX_2[x]=(t<<8)|(t>>>24);SUB_MIX_3[x]=t;var t=(x8*0x1010101)^(x4*0x10001)^(x2*0x101)^(x*0x1010100);INV_SUB_MIX_0[sx]=(t<<24)|(t>>>8);INV_SUB_MIX_1[sx]=(t<<16)|(t>>>16);INV_SUB_MIX_2[sx]=(t<<8)|(t>>>24);INV_SUB_MIX_3[sx]=t;if(!x){x=xi=1;}else{x=x2^d[d[d[x8^x2]]];xi^=d[d[xi]];}}}());var RCON=[0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x1b,0x36];var AES=C_algo.AES=BlockCipher.extend({_doReset:function(){var key=this._key;var keyWords=key.words;var keySize=key.sigBytes/4;var nRounds=this._nRounds=keySize+6
var ksRows=(nRounds+1)*4;var keySchedule=this._keySchedule=[];for(var ksRow=0;ksRow<ksRows;ksRow++){if(ksRow<keySize){keySchedule[ksRow]=keyWords[ksRow];}else{var t=keySchedule[ksRow-1];if(!(ksRow%keySize)){t=(t<<8)|(t>>>24);t=(SBOX[t>>>24]<<24)|(SBOX[(t>>>16)&0xff]<<16)|(SBOX[(t>>>8)&0xff]<<8)|SBOX[t&0xff];t^=RCON[(ksRow/keySize)|0]<<24;}else if(keySize>6&&ksRow%keySize==4){t=(SBOX[t>>>24]<<24)|(SBOX[(t>>>16)&0xff]<<16)|(SBOX[(t>>>8)&0xff]<<8)|SBOX[t&0xff];}
keySchedule[ksRow]=keySchedule[ksRow-keySize]^t;}}
var invKeySchedule=this._invKeySchedule=[];for(var invKsRow=0;invKsRow<ksRows;invKsRow++){var ksRow=ksRows-invKsRow;if(invKsRow%4){var t=keySchedule[ksRow];}else{var t=keySchedule[ksRow-4];}
if(invKsRow<4||ksRow<=4){invKeySchedule[invKsRow]=t;}else{invKeySchedule[invKsRow]=INV_SUB_MIX_0[SBOX[t>>>24]]^INV_SUB_MIX_1[SBOX[(t>>>16)&0xff]]^INV_SUB_MIX_2[SBOX[(t>>>8)&0xff]]^INV_SUB_MIX_3[SBOX[t&0xff]];}}},encryptBlock:function(M,offset){this._doCryptBlock(M,offset,this._keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX);},decryptBlock:function(M,offset){var t=M[offset+1];M[offset+1]=M[offset+3];M[offset+3]=t;this._doCryptBlock(M,offset,this._invKeySchedule,INV_SUB_MIX_0,INV_SUB_MIX_1,INV_SUB_MIX_2,INV_SUB_MIX_3,INV_SBOX);var t=M[offset+1];M[offset+1]=M[offset+3];M[offset+3]=t;},_doCryptBlock:function(M,offset,keySchedule,SUB_MIX_0,SUB_MIX_1,SUB_MIX_2,SUB_MIX_3,SBOX){var nRounds=this._nRounds;var s0=M[offset]^keySchedule[0];var s1=M[offset+1]^keySchedule[1];var s2=M[offset+2]^keySchedule[2];var s3=M[offset+3]^keySchedule[3];var ksRow=4;for(var round=1;round<nRounds;round++){var t0=SUB_MIX_0[s0>>>24]^SUB_MIX_1[(s1>>>16)&0xff]^SUB_MIX_2[(s2>>>8)&0xff]^SUB_MIX_3[s3&0xff]^keySchedule[ksRow++];var t1=SUB_MIX_0[s1>>>24]^SUB_MIX_1[(s2>>>16)&0xff]^SUB_MIX_2[(s3>>>8)&0xff]^SUB_MIX_3[s0&0xff]^keySchedule[ksRow++];var t2=SUB_MIX_0[s2>>>24]^SUB_MIX_1[(s3>>>16)&0xff]^SUB_MIX_2[(s0>>>8)&0xff]^SUB_MIX_3[s1&0xff]^keySchedule[ksRow++];var t3=SUB_MIX_0[s3>>>24]^SUB_MIX_1[(s0>>>16)&0xff]^SUB_MIX_2[(s1>>>8)&0xff]^SUB_MIX_3[s2&0xff]^keySchedule[ksRow++];s0=t0;s1=t1;s2=t2;s3=t3;}
var t0=((SBOX[s0>>>24]<<24)|(SBOX[(s1>>>16)&0xff]<<16)|(SBOX[(s2>>>8)&0xff]<<8)|SBOX[s3&0xff])^keySchedule[ksRow++];var t1=((SBOX[s1>>>24]<<24)|(SBOX[(s2>>>16)&0xff]<<16)|(SBOX[(s3>>>8)&0xff]<<8)|SBOX[s0&0xff])^keySchedule[ksRow++];var t2=((SBOX[s2>>>24]<<24)|(SBOX[(s3>>>16)&0xff]<<16)|(SBOX[(s0>>>8)&0xff]<<8)|SBOX[s1&0xff])^keySchedule[ksRow++];var t3=((SBOX[s3>>>24]<<24)|(SBOX[(s0>>>16)&0xff]<<16)|(SBOX[(s1>>>8)&0xff]<<8)|SBOX[s2&0xff])^keySchedule[ksRow++];M[offset]=t0;M[offset+1]=t1;M[offset+2]=t2;M[offset+3]=t3;},keySize:256/32});C.AES=BlockCipher._createHelper(AES);}());
CryptoJS.mode.CTR=(function(){var CTR=CryptoJS.lib.BlockCipherMode.extend();var Encryptor=CTR.Encryptor=CTR.extend({processBlock:function(words,offset){var cipher=this._cipher
var blockSize=cipher.blockSize;var iv=this._iv;var counter=this._counter;if(iv){counter=this._counter=iv.slice(0);this._iv=undefined;}
var keystream=counter.slice(0);cipher.encryptBlock(keystream,0);counter[blockSize-1]=(counter[blockSize-1]+1)|0
for(var i=0;i<blockSize;i++){words[offset+i]^=keystream[i];}}});CTR.Decryptor=Encryptor;return CTR;}());
CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}};
(function(Math){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var H=[];var K=[];(function(){function isPrime(n){var sqrtN=Math.sqrt(n);for(var factor=2;factor<=sqrtN;factor++){if(!(n%factor)){return false;}}
return true;}
function getFractionalBits(n){return((n-(n|0))*0x100000000)|0;}
var n=2;var nPrime=0;while(nPrime<64){if(isPrime(n)){if(nPrime<8){H[nPrime]=getFractionalBits(Math.pow(n,1/2));}
K[nPrime]=getFractionalBits(Math.pow(n,1/3));nPrime++;}
n++;}}());var W=[];var SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=WordArray.create(H.slice(0));},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];var f=H[5];var g=H[6];var h=H[7];for(var i=0;i<64;i++){if(i<16){W[i]=M[offset+i]|0;}else{var gamma0x=W[i-15];var gamma0=((gamma0x<<25)|(gamma0x>>>7))^((gamma0x<<14)|(gamma0x>>>18))^(gamma0x>>>3);var gamma1x=W[i-2];var gamma1=((gamma1x<<15)|(gamma1x>>>17))^((gamma1x<<13)|(gamma1x>>>19))^(gamma1x>>>10);W[i]=gamma0+W[i-7]+gamma1+W[i-16];}
var ch=(e&f)^(~e&g);var maj=(a&b)^(a&c)^(b&c);var sigma0=((a<<30)|(a>>>2))^((a<<19)|(a>>>13))^((a<<10)|(a>>>22));var sigma1=((e<<26)|(e>>>6))^((e<<21)|(e>>>11))^((e<<7)|(e>>>25));var t1=h+sigma1+ch+K[i]+W[i];var t2=sigma0+maj;h=g;g=f;f=e;e=(d+t1)|0;d=c;c=b;b=a;a=(t1+t2)|0;}
H[0]=(H[0]+a)|0;H[1]=(H[1]+b)|0;H[2]=(H[2]+c)|0;H[3]=(H[3]+d)|0;H[4]=(H[4]+e)|0;H[5]=(H[5]+f)|0;H[6]=(H[6]+g)|0;H[7]=(H[7]+h)|0;},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=0x80<<(24-nBitsLeft%32);dataWords[(((nBitsLeft+64)>>>9)<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();}});C.SHA256=Hasher._createHelper(SHA256);C.HmacSHA256=Hasher._createHmacHelper(SHA256);}(Math));
(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var Hasher=C_lib.Hasher;var C_algo=C.algo;var W=[];var SHA1=C_algo.SHA1=Hasher.extend({_doReset:function(){this._hash=WordArray.create([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]);},_doProcessBlock:function(M,offset){var H=this._hash.words;var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];for(var i=0;i<80;i++){if(i<16){W[i]=M[offset+i]|0;}else{var n=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=(n<<1)|(n>>>31);}
var t=((a<<5)|(a>>>27))+e+W[i];if(i<20){t+=((b&c)|(~b&d))+0x5a827999;}else if(i<40){t+=(b^c^d)+0x6ed9eba1;}else if(i<60){t+=((b&c)|(b&d)|(c&d))-0x70e44324;}else{t+=(b^c^d)-0x359d3e2a;}
e=d;d=c;c=(b<<30)|(b>>>2);b=a;a=t;}
H[0]=(H[0]+a)|0;H[1]=(H[1]+b)|0;H[2]=(H[2]+c)|0;H[3]=(H[3]+d)|0;H[4]=(H[4]+e)|0;},_doFinalize:function(){var data=this._data;var dataWords=data.words;var nBitsTotal=this._nDataBytes*8;var nBitsLeft=data.sigBytes*8;dataWords[nBitsLeft>>>5]|=0x80<<(24-nBitsLeft%32);dataWords[(((nBitsLeft+64)>>>9)<<4)+15]=nBitsTotal;data.sigBytes=dataWords.length*4;this._process();}});C.SHA1=Hasher._createHelper(SHA1);C.HmacSHA1=Hasher._createHmacHelper(SHA1);}());
(function(){var C=CryptoJS;var C_lib=C.lib;var Base=C_lib.Base;var C_enc=C.enc;var Utf8=C_enc.Utf8;var C_algo=C.algo;var HMAC=C_algo.HMAC=Base.extend({init:function(hasher,key){hasher=this._hasher=hasher.create();if(typeof key=='string'){key=Utf8.parse(key);}
var hasherBlockSize=hasher.blockSize;var hasherBlockSizeBytes=hasherBlockSize*4;if(key.sigBytes>hasherBlockSizeBytes){key=hasher.finalize(key);}
var oKey=this._oKey=key.clone();var iKey=this._iKey=key.clone();var oKeyWords=oKey.words;var iKeyWords=iKey.words;for(var i=0;i<hasherBlockSize;i++){oKeyWords[i]^=0x5c5c5c5c;iKeyWords[i]^=0x36363636;}
oKey.sigBytes=iKey.sigBytes=hasherBlockSizeBytes;this.reset();},reset:function(){var hasher=this._hasher;hasher.reset();hasher.update(this._iKey);},update:function(messageUpdate){this._hasher.update(messageUpdate);return this;},finalize:function(messageUpdate){var hasher=this._hasher;var innerHash=hasher.finalize(messageUpdate);hasher.reset();var hmac=hasher.finalize(this._oKey.clone().concat(innerHash));return hmac;}});}());
var Otr=Otr||(function(){"use strict";var _={MSGSTATE_PLAINTEXT:0,MSGSTATE_ENCRYPTED:1,MSGSTATE_FINISHED:2,AUTHSTATE_NONE:0,AUTHSTATE_AWAITING_DHKEY:1,AUTHSTATE_AWAITING_REVEALSIG:2,AUTHSTATE_AWAITING_SIG:3,AUTHSTATE_V1_SETUP:4,ALLOW_V1:0x01,ALLOW_V2:0x02,REQUIRE_ENCRYPTION:0x04,SEND_WHITESPACE_TAG:0x08,WHITESPACE_START_AKE:0x10,ERROR_START_AKE:0x20};_.NEVER=0x00;_.MANUAL=(_.ALLOW_V1|_.ALLOW_V2);_.OPPORTUNISTIC=(_.ALLOW_V1|_.ALLOW_V2|_.SEND_WHITESPACE_TAG|_.WHITESPACE_START_AKE|_.ERROR_START_AKE);_.ALWAYS=(_.ALLOW_V1|_.ALLOW_V2|_.REQUIRE_ENCRYPTION|_.WHITESPACE_START_AKE|_.ERROR_START_AKE);return _;}());
Otr.Util=(function(){var Util={byteArrayToWordArray:function(ba){var offset=0,sigBytes=ba.length,words=[];while(offset<sigBytes){words.push((ba[offset++]&0xFF)<<24|(ba[offset++]&0xFF)<<16|(ba[offset++]&0xFF)<<8|(ba[offset++]&0xFF));}
return CryptoJS.lib.WordArray.create(words,sigBytes);},wordArrayToByteArray:function(wa){var ba=[],i,l,word,remains=wa.sigBytes;for(i=0,l=wa.words.length;i<l;++i){word=wa.words[i];if(remains>=4){ba.push((word>>24)&0xFF);ba.push((word>>16)&0xFF);ba.push((word>>8)&0xFF);ba.push((word)&0xFF);}else if(remains===3){ba.push((word>>24)&0xFF);ba.push((word>>16)&0xFF);ba.push((word>>8)&0xFF);}else if(remains===2){ba.push((word>>24)&0xFF);ba.push((word>>16)&0xFF);}else if(remains===1){ba.push((word>>24)&0xFF);}else{break;}
remains-=4;}
return ba;},stringToByteArray:function(str){var i,l,ba=[];for(i=0,l=str.length;i<l;++i){ba[i]=str.charCodeAt(i)&0xFF;}
return ba;},createIV:function(bit,tophalf){var nbyte=Math.floor(bit/8),nword=Math.floor(bit/32),i,l,words=[];if(tophalf){for(i=0,l=tophalf.length;i<l;i+=4){words.push((tophalf[i]&0xFF)<<24|(tophalf[i+1]&0xFF)<<16|(tophalf[i+2]&0xFF)<<8|(tophalf[i+3]&0xFF));}
nword-=Math.ceil(tophalf.length/4);}
for(i=0;i<nword;++i){words.push(0);}
return CryptoJS.lib.WordArray.create(words,nbyte);},bytesEqual:function(bytes1,bytes2){var len=bytes1.length;if(bytes1.length!==bytes2.length)return false;while(len--){if((bytes1[len]&0xFF)!==(bytes2[len]&0xFF))return false;}
return true;},correctWordsLength:function(wa){wa.words.length=Math.floor((wa.sigBytes-1)/4)+1;}};return Util;}());(function(){bpe=0;mask=0;radix=mask+1;digitsStr='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\\'\"+-';for(bpe=0;(1<<(bpe+1))>(1<<bpe);bpe++);bpe>>=1;mask=(1<<bpe)-1;radix=mask+1;one=int2bigInt(1,1,1);t=new Array(0);ss=t;s0=t;s1=t;s2=t;s3=t;s4=t;s5=t;s6=t;s7=t;T=t;sa=t;mr_x1=t;mr_r=t;mr_a=t;eg_v=t;eg_u=t;eg_A=t;eg_B=t;eg_C=t;eg_D=t;md_q1=t;md_q2=t;md_q3=t;md_r=t;md_r1=t;md_r2=t;md_tt=t;primes=t;pows=t;s_i=t;s_i2=t;s_R=t;s_rm=t;s_q=t;s_n1=t;s_a=t;s_r2=t;s_n=t;s_b=t;s_d=t;s_x1=t;s_x2=t,s_aa=t;rpprb=t;function findPrimes(n){var i,s,p,ans;s=new Array(n);for(i=0;i<n;i++)
s[i]=0;s[0]=2;p=0;for(;s[p]<n;){for(i=s[p]*s[p];i<n;i+=s[p])
s[i]=1;p++;s[p]=s[p-1]+1;for(;s[p]<n&&s[s[p]];s[p]++);}
ans=new Array(p);for(i=0;i<p;i++)
ans[i]=s[i];return ans;}
function millerRabinInt(x,b){if(mr_x1.length!=x.length){mr_x1=dup(x);mr_r=dup(x);mr_a=dup(x);}
copyInt_(mr_a,b);return millerRabin(x,mr_a);}
function millerRabin(x,b){var i,j,k,s;if(mr_x1.length!=x.length){mr_x1=dup(x);mr_r=dup(x);mr_a=dup(x);}
copy_(mr_a,b);copy_(mr_r,x);copy_(mr_x1,x);addInt_(mr_r,-1);addInt_(mr_x1,-1);k=0;for(i=0;i<mr_r.length;i++)
for(j=1;j<mask;j<<=1)
if(x[i]&j){s=(k<mr_r.length+bpe?k:0);i=mr_r.length;j=mask;}else
k++;if(s)
rightShift_(mr_r,s);powMod_(mr_a,mr_r,x);if(!equalsInt(mr_a,1)&&!equals(mr_a,mr_x1)){j=1;while(j<=s-1&&!equals(mr_a,mr_x1)){squareMod_(mr_a,x);if(equalsInt(mr_a,1)){return 0;}
j++;}
if(!equals(mr_a,mr_x1)){return 0;}}
return 1;}
function bitSize(x){var j,z,w;for(j=x.length-1;(x[j]==0)&&(j>0);j--);for(z=0,w=x[j];w;(w>>=1),z++);z+=bpe*j;return z;}
function expand(x,n){var ans=int2bigInt(0,(x.length>n?x.length:n)*bpe,0);copy_(ans,x);return ans;}
function randTruePrime(k){var ans=int2bigInt(0,k,0);randTruePrime_(ans,k);return trim(ans,1);}
function randProbPrime(k){if(k>=600)return randProbPrimeRounds(k,2);if(k>=550)return randProbPrimeRounds(k,4);if(k>=500)return randProbPrimeRounds(k,5);if(k>=400)return randProbPrimeRounds(k,6);if(k>=350)return randProbPrimeRounds(k,7);if(k>=300)return randProbPrimeRounds(k,9);if(k>=250)return randProbPrimeRounds(k,12);if(k>=200)return randProbPrimeRounds(k,15);if(k>=150)return randProbPrimeRounds(k,18);if(k>=100)return randProbPrimeRounds(k,27);return randProbPrimeRounds(k,40);}
function randProbPrimeRounds(k,n){var ans,i,divisible,B;B=30000;ans=int2bigInt(0,k,0);if(primes.length==0)
primes=findPrimes(30000);if(rpprb.length!=ans.length)
rpprb=dup(ans);for(;;){randBigInt_(ans,k,0);ans[0]|=1;divisible=0;for(i=0;(i<primes.length)&&(primes[i]<=B);i++)
if(modInt(ans,primes[i])==0&&!equalsInt(ans,primes[i])){divisible=1;break;}
for(i=0;i<n&&!divisible;i++){randBigInt_(rpprb,k,0);while(!greater(ans,rpprb))
randBigInt_(rpprb,k,0);if(!millerRabin(ans,rpprb))
divisible=1;}
if(!divisible)
return ans;}}
function mod(x,n){var ans=dup(x);mod_(ans,n);return trim(ans,1);}
function addInt(x,n){var ans=expand(x,x.length+1);addInt_(ans,n);return trim(ans,1);}
function mult(x,y){var ans=expand(x,x.length+y.length);mult_(ans,y);return trim(ans,1);}
function powMod(x,y,n){var ans=expand(x,n.length);powMod_(ans,trim(y,2),trim(n,2),0);return trim(ans,1);}
function sub(x,y){var ans=expand(x,(x.length>y.length?x.length+1:y.length+1));sub_(ans,y);return trim(ans,1);}
function add(x,y){var ans=expand(x,(x.length>y.length?x.length+1:y.length+1));add_(ans,y);return trim(ans,1);}
function inverseMod(x,n){var ans=expand(x,n.length);var s;s=inverseMod_(ans,n);return s?trim(ans,1):null;}
function multMod(x,y,n){var ans=expand(x,n.length);multMod_(ans,y,n);return trim(ans,1);}
function randTruePrime_(ans,k){var c,m,pm,dd,j,r,B,divisible,z,zz,recSize;if(primes.length==0)
primes=findPrimes(30000);if(pows.length==0){pows=new Array(512);for(j=0;j<512;j++){pows[j]=Math.pow(2,j/511.-1.);}}
c=0.1;m=20;recLimit=20;if(s_i2.length!=ans.length){s_i2=dup(ans);s_R=dup(ans);s_n1=dup(ans);s_r2=dup(ans);s_d=dup(ans);s_x1=dup(ans);s_x2=dup(ans);s_b=dup(ans);s_n=dup(ans);s_i=dup(ans);s_rm=dup(ans);s_q=dup(ans);s_a=dup(ans);s_aa=dup(ans);}
if(k<=recLimit){pm=(1<<((k+2)>>1))-1;copyInt_(ans,0);for(dd=1;dd;){dd=0;ans[0]=1|(1<<(k-1))|Math.floor(Math.random()*(1<<k));for(j=1;(j<primes.length)&&((primes[j]&pm)==primes[j]);j++){if(0==(ans[0]%primes[j])){dd=1;break;}}}
carry_(ans);return;}
B=c*k*k;if(k>2*m)
for(r=1;k-k*r<=m;)
r=pows[Math.floor(Math.random()*512)];else
r=.5;recSize=Math.floor(r*k)+1;randTruePrime_(s_q,recSize);copyInt_(s_i2,0);s_i2[Math.floor((k-2)/bpe)]|=(1<<((k-2)%bpe));divide_(s_i2,s_q,s_i,s_rm);z=bitSize(s_i);for(;;){for(;;){randBigInt_(s_R,z,0);if(greater(s_i,s_R))
break;}
addInt_(s_R,1);add_(s_R,s_i);copy_(s_n,s_q);mult_(s_n,s_R);multInt_(s_n,2);addInt_(s_n,1);copy_(s_r2,s_R);multInt_(s_r2,2);for(divisible=0,j=0;(j<primes.length)&&(primes[j]<B);j++)
if(modInt(s_n,primes[j])==0&&!equalsInt(s_n,primes[j])){divisible=1;break;}
if(!divisible)
if(!millerRabinInt(s_n,2))
divisible=1;if(!divisible){addInt_(s_n,-3);for(j=s_n.length-1;(s_n[j]==0)&&(j>0);j--);for(zz=0,w=s_n[j];w;(w>>=1),zz++);zz+=bpe*j;for(;;){randBigInt_(s_a,zz,0);if(greater(s_n,s_a))
break;}
addInt_(s_n,3);addInt_(s_a,2);copy_(s_b,s_a);copy_(s_n1,s_n);addInt_(s_n1,-1);powMod_(s_b,s_n1,s_n);addInt_(s_b,-1);if(isZero(s_b)){copy_(s_b,s_a);powMod_(s_b,s_r2,s_n);addInt_(s_b,-1);copy_(s_aa,s_n);copy_(s_d,s_b);GCD_(s_d,s_n);if(equalsInt(s_d,1)){copy_(ans,s_aa);return;}}}}}
function randBigInt(n,s){var a,b;a=Math.floor((n-1)/bpe)+2;b=int2bigInt(0,0,a);randBigInt_(b,n,s);return b;}
function randBigInt_(b,n,s){var i,a;for(i=0;i<b.length;i++)
b[i]=0;a=Math.floor((n-1)/bpe)+1;for(i=0;i<a;i++){b[i]=Math.floor(Math.random()*(1<<(bpe-1)));}
b[a-1]&=(2<<((n-1)%bpe))-1;if(s==1)
b[a-1]|=(1<<((n-1)%bpe));}
function GCD(x,y){var xc,yc;xc=dup(x);yc=dup(y);GCD_(xc,yc);return xc;}
function GCD_(x,y){var i,xp,yp,A,B,C,D,q,sing;if(T.length!=x.length)
T=dup(x);sing=1;while(sing){sing=0;for(i=1;i<y.length;i++)
if(y[i]){sing=1;break;}
if(!sing)break;for(i=x.length;!x[i]&&i>=0;i--);xp=x[i];yp=y[i];A=1;B=0;C=0;D=1;while((yp+C)&&(yp+D)){q=Math.floor((xp+A)/(yp+C));qp=Math.floor((xp+B)/(yp+D));if(q!=qp)
break;t=A-q*C;A=C;C=t;t=B-q*D;B=D;D=t;t=xp-q*yp;xp=yp;yp=t;}
if(B){copy_(T,x);linComb_(x,y,A,B);linComb_(y,T,D,C);}else{mod_(x,y);copy_(T,x);copy_(x,y);copy_(y,T);}}
if(y[0]==0)
return;t=modInt(x,y[0]);copyInt_(x,y[0]);y[0]=t;while(y[0]){x[0]%=y[0];t=x[0];x[0]=y[0];y[0]=t;}}
function inverseMod_(x,n){var k=1+2*Math.max(x.length,n.length);if(!(x[0]&1)&&!(n[0]&1)){copyInt_(x,0);return 0;}
if(eg_u.length!=k){eg_u=new Array(k);eg_v=new Array(k);eg_A=new Array(k);eg_B=new Array(k);eg_C=new Array(k);eg_D=new Array(k);}
copy_(eg_u,x);copy_(eg_v,n);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B);}else{add_(eg_A,n);halve_(eg_A);sub_(eg_B,x);halve_(eg_B);}}
while(!(eg_v[0]&1)){halve_(eg_v);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D);}else{add_(eg_C,n);halve_(eg_C);sub_(eg_D,x);halve_(eg_D);}}
if(!greater(eg_v,eg_u)){sub_(eg_u,eg_v);sub_(eg_A,eg_C);sub_(eg_B,eg_D);}else{sub_(eg_v,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B);}
if(equalsInt(eg_u,0)){if(negative(eg_C))
add_(eg_C,n);copy_(x,eg_C);if(!equalsInt(eg_v,1)){copyInt_(x,0);return 0;}
return 1;}}}
function inverseModInt(x,n){var a=1,b=0,t;for(;;){if(x==1)return a;if(x==0)return 0;b-=a*Math.floor(n/x);n%=x;if(n==1)return b;if(n==0)return 0;a-=b*Math.floor(x/n);x%=n;}}
function inverseModInt_(x,n){return inverseModInt(x,n);}
function eGCD_(x,y,v,a,b){var g=0;var k=Math.max(x.length,y.length);if(eg_u.length!=k){eg_u=new Array(k);eg_A=new Array(k);eg_B=new Array(k);eg_C=new Array(k);eg_D=new Array(k);}
while(!(x[0]&1)&&!(y[0]&1)){halve_(x);halve_(y);g++;}
copy_(eg_u,x);copy_(v,y);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B);}else{add_(eg_A,y);halve_(eg_A);sub_(eg_B,x);halve_(eg_B);}}
while(!(v[0]&1)){halve_(v);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D);}else{add_(eg_C,y);halve_(eg_C);sub_(eg_D,x);halve_(eg_D);}}
if(!greater(v,eg_u)){sub_(eg_u,v);sub_(eg_A,eg_C);sub_(eg_B,eg_D);}else{sub_(v,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B);}
if(equalsInt(eg_u,0)){if(negative(eg_C)){add_(eg_C,y);sub_(eg_D,x);}
multInt_(eg_D,-1);copy_(a,eg_C);copy_(b,eg_D);leftShift_(v,g);return;}}}
function negative(x){return((x[x.length-1]>>(bpe-1))&1);}
function greaterShift(x,y,shift){var i,kx=x.length,ky=y.length;k=((kx+shift)<ky)?(kx+shift):ky;for(i=ky-1-shift;i<kx&&i>=0;i++)
if(x[i]>0)
return 1;for(i=kx-1+shift;i<ky;i++)
if(y[i]>0)
return 0;for(i=k-1;i>=shift;i--)
if(x[i-shift]>y[i])return 1;else if(x[i-shift]<y[i])return 0;return 0;}
function greater(x,y){var i;var k=(x.length<y.length)?x.length:y.length;for(i=x.length;i<y.length;i++)
if(y[i])
return 0;for(i=y.length;i<x.length;i++)
if(x[i])
return 1;for(i=k-1;i>=0;i--)
if(x[i]>y[i])
return 1;else if(x[i]<y[i])
return 0;return 0;}
function divide_(x,y,q,r){var kx,ky;var i,j,y1,y2,c,a,b;copy_(r,x);for(ky=y.length;y[ky-1]==0;ky--);b=y[ky-1];for(a=0;b;a++)
b>>=1;a=bpe-a;leftShift_(y,a);leftShift_(r,a);for(kx=r.length;r[kx-1]==0&&kx>ky;kx--);copyInt_(q,0);while(!greaterShift(y,r,kx-ky)){subShift_(r,y,kx-ky);q[kx-ky]++;}
for(i=kx-1;i>=ky;i--){if(r[i]==y[ky-1])
q[i-ky]=mask;else
q[i-ky]=Math.floor((r[i]*radix+r[i-1])/y[ky-1]);for(;;){y2=(ky>1?y[ky-2]:0)*q[i-ky];c=y2>>bpe;y2=y2&mask;y1=c+q[i-ky]*y[ky-1];c=y1>>bpe;y1=y1&mask;if(c==r[i]?y1==r[i-1]?y2>(i>1?r[i-2]:0):y1>r[i-1]:c>r[i])
q[i-ky]--;else
break;}
linCombShift_(r,y,-q[i-ky],i-ky);if(negative(r)){addShift_(r,y,i-ky);q[i-ky]--;}}
rightShift_(y,a);rightShift_(r,a);}
function carry_(x){var i,k,c,b;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i];b=0;if(c<0){b=-(c>>bpe);c+=b*radix;}
x[i]=c&mask;c=(c>>bpe)-b;}}
function modInt(x,n){var i,c=0;for(i=x.length-1;i>=0;i--)
c=(c*radix+x[i])%n;return c;}
function int2bigInt(t,bits,minSize){var i,k;k=Math.ceil(bits/bpe)+1;k=minSize>k?minSize:k;buff=new Array(k);copyInt_(buff,t);return buff;}
function str2bigInt(s,base,minSize){var d,i,j,x,y,kk;var k=s.length;if(base==-1){x=new Array(0);for(;;){y=new Array(x.length+1);for(i=0;i<x.length;i++)
y[i+1]=x[i];y[0]=parseInt(s,10);x=y;d=s.indexOf(',',0);if(d<1)
break;s=s.substring(d+1);if(s.length==0)
break;}
if(x.length<minSize){y=new Array(minSize);copy_(y,x);return y;}
return x;}
x=int2bigInt(0,base*k,0);for(i=0;i<k;i++){d=digitsStr.indexOf(s.substring(i,i+1),0);if(base<=36&&d>=36)
d-=26;if(d>=base||d<0){break;}
multInt_(x,base);addInt_(x,d);}
for(k=x.length;k>0&&!x[k-1];k--);k=minSize>k+1?minSize:k+1;y=new Array(k);kk=k<x.length?k:x.length;for(i=0;i<kk;i++)
y[i]=x[i];for(;i<k;i++)
y[i]=0;return y;}
function equalsInt(x,y){var i;if(x[0]!=y)
return 0;for(i=1;i<x.length;i++)
if(x[i])
return 0;return 1;}
function equals(x,y){var i;var k=x.length<y.length?x.length:y.length;for(i=0;i<k;i++)
if(x[i]!=y[i])
return 0;if(x.length>y.length){for(;i<x.length;i++)
if(x[i])
return 0;}else{for(;i<y.length;i++)
if(y[i])
return 0;}
return 1;}
function isZero(x){var i;for(i=0;i<x.length;i++)
if(x[i])
return 0;return 1;}
function bigInt2str(x,base){var i,t,s="";if(s6.length!=x.length)
s6=dup(x);else
copy_(s6,x);if(base==-1){for(i=x.length-1;i>0;i--)
s+=x[i]+',';s+=x[0];}
else{while(!isZero(s6)){t=divInt_(s6,base);s=digitsStr.substring(t,t+1)+s;}}
if(s.length==0)
s="0";return s;}
function dup(x){var i;buff=new Array(x.length);copy_(buff,x);return buff;}
function copy_(x,y){var i;var k=x.length<y.length?x.length:y.length;for(i=0;i<k;i++)
x[i]=y[i];for(i=k;i<x.length;i++)
x[i]=0;}
function copyInt_(x,n){var i,c;for(c=n,i=0;i<x.length;i++){x[i]=c&mask;c>>=bpe;}}
function addInt_(x,n){var i,k,c,b;x[0]+=n;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i];b=0;if(c<0){b=-(c>>bpe);c+=b*radix;}
x[i]=c&mask;c=(c>>bpe)-b;if(!c)return;}}
function rightShift_(x,n){var i;var k=Math.floor(n/bpe);if(k){for(i=0;i<x.length-k;i++)
x[i]=x[i+k];for(;i<x.length;i++)
x[i]=0;n%=bpe;}
for(i=0;i<x.length-1;i++){x[i]=mask&((x[i+1]<<(bpe-n))|(x[i]>>n));}
x[i]>>=n;}
function halve_(x){var i;for(i=0;i<x.length-1;i++){x[i]=mask&((x[i+1]<<(bpe-1))|(x[i]>>1));}
x[i]=(x[i]>>1)|(x[i]&(radix>>1));}
function leftShift_(x,n){var i;var k=Math.floor(n/bpe);if(k){for(i=x.length;i>=k;i--)
x[i]=x[i-k];for(;i>=0;i--)
x[i]=0;n%=bpe;}
if(!n)
return;for(i=x.length-1;i>0;i--){x[i]=mask&((x[i]<<n)|(x[i-1]>>(bpe-n)));}
x[i]=mask&(x[i]<<n);}
function multInt_(x,n){var i,k,c,b;if(!n)
return;k=x.length;c=0;for(i=0;i<k;i++){c+=x[i]*n;b=0;if(c<0){b=-(c>>bpe);c+=b*radix;}
x[i]=c&mask;c=(c>>bpe)-b;}}
function divInt_(x,n){var i,r=0,s;for(i=x.length-1;i>=0;i--){s=r*radix+x[i];x[i]=Math.floor(s/n);r=s%n;}
return r;}
function linComb_(x,y,a,b){var i,c,k,kk;k=x.length<y.length?x.length:y.length;kk=x.length;for(c=0,i=0;i<k;i++){c+=a*x[i]+b*y[i];x[i]=c&mask;c>>=bpe;}
for(i=k;i<kk;i++){c+=a*x[i];x[i]=c&mask;c>>=bpe;}}
function linCombShift_(x,y,b,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]+b*y[i-ys];x[i]=c&mask;c>>=bpe;}
for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe;}}
function addShift_(x,y,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]+y[i-ys];x[i]=c&mask;c>>=bpe;}
for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe;}}
function subShift_(x,y,ys){var i,c,k,kk;k=x.length<ys+y.length?x.length:ys+y.length;kk=x.length;for(c=0,i=ys;i<k;i++){c+=x[i]-y[i-ys];x[i]=c&mask;c>>=bpe;}
for(i=k;c&&i<kk;i++){c+=x[i];x[i]=c&mask;c>>=bpe;}}
function sub_(x,y){var i,c,k,kk;k=x.length<y.length?x.length:y.length;for(c=0,i=0;i<k;i++){c+=x[i]-y[i];x[i]=c&mask;c>>=bpe;}
for(i=k;c&&i<x.length;i++){c+=x[i];x[i]=c&mask;c>>=bpe;}}
function add_(x,y){var i,c,k,kk;k=x.length<y.length?x.length:y.length;for(c=0,i=0;i<k;i++){c+=x[i]+y[i];x[i]=c&mask;c>>=bpe;}
for(i=k;c&&i<x.length;i++){c+=x[i];x[i]=c&mask;c>>=bpe;}}
function mult_(x,y){var i;if(ss.length!=2*x.length)
ss=new Array(2*x.length);copyInt_(ss,0);for(i=0;i<y.length;i++)
if(y[i])
linCombShift_(ss,x,y[i],i);copy_(x,ss);}
function mod_(x,n){if(s4.length!=x.length)
s4=dup(x);else
copy_(s4,x);if(s5.length!=x.length)
s5=dup(x);divide_(s4,n,s5,x);}
function multMod_(x,y,n){var i;if(s0.length!=2*x.length)
s0=new Array(2*x.length);copyInt_(s0,0);for(i=0;i<y.length;i++)
if(y[i])
linCombShift_(s0,x,y[i],i);mod_(s0,n);copy_(x,s0);}
function squareMod_(x,n){var i,j,d,c,kx,kn,k;for(kx=x.length;kx>0&&!x[kx-1];kx--);k=kx>n.length?2*kx:2*n.length;if(s0.length!=k)
s0=new Array(k);copyInt_(s0,0);for(i=0;i<kx;i++){c=s0[2*i]+x[i]*x[i];s0[2*i]=c&mask;c>>=bpe;for(j=i+1;j<kx;j++){c=s0[i+j]+2*x[i]*x[j]+c;s0[i+j]=(c&mask);c>>=bpe;}
s0[i+kx]=c;}
mod_(s0,n);copy_(x,s0);}
function trim(x,k){var i,y;for(i=x.length;i>0&&!x[i-1];i--);y=new Array(i+k);copy_(y,x);return y;}
function powMod_(x,y,n){var k1,k2,kn,np;if(s7.length!=n.length)
s7=dup(n);if((n[0]&1)==0){copy_(s7,x);copyInt_(x,1);while(!equalsInt(y,0)){if(y[0]&1)
multMod_(x,s7,n);divInt_(y,2);squareMod_(s7,n);}
return;}
copyInt_(s7,0);for(kn=n.length;kn>0&&!n[kn-1];kn--);np=radix-inverseModInt(modInt(n,radix),radix);s7[kn]=1;multMod_(x,s7,n);if(s3.length!=x.length)
s3=dup(x);else
copy_(s3,x);for(k1=y.length-1;k1>0&!y[k1];k1--);if(y[k1]==0){copyInt_(x,1);return;}
for(k2=1<<(bpe-1);k2&&!(y[k1]&k2);k2>>=1);for(;;){if(!(k2>>=1)){k1--;if(k1<0){mont_(x,one,n,np);return;}
k2=1<<(bpe-1);}
mont_(x,x,n,np);if(k2&y[k1])
mont_(x,s3,n,np);}}
function mont_(x,y,n,np){var i,j,c,ui,t,ks;var kn=n.length;var ky=y.length;if(sa.length!=kn)
sa=new Array(kn);copyInt_(sa,0);for(;kn>0&&n[kn-1]==0;kn--);for(;ky>0&&y[ky-1]==0;ky--);ks=sa.length-1;for(i=0;i<kn;i++){t=sa[0]+x[i]*y[0];ui=((t&mask)*np)&mask;c=(t+ui*n[0])>>bpe;t=x[i];j=1;for(;j<ky-4;){c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;}
for(;j<ky;){c+=sa[j]+ui*n[j]+t*y[j];sa[j-1]=c&mask;c>>=bpe;j++;}
for(;j<kn-4;){c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;}
for(;j<kn;){c+=sa[j]+ui*n[j];sa[j-1]=c&mask;c>>=bpe;j++;}
for(;j<ks;){c+=sa[j];sa[j-1]=c&mask;c>>=bpe;j++;}
sa[j-1]=c&mask;}
if(!greater(n,sa))
sub_(sa,n);copy_(x,sa);}
Otr.Util.powMod=function(biX,biY,biN){biX=str2bigInt(biX.toString(16),16);biY=str2bigInt(biY.toString(16),16);biN=str2bigInt(biN.toString(16),16);return new Otr.BigInteger(bigInt2str(powMod(biX,biY,biN),16),16);};}());
Otr.BigInteger=(function(){var dbits;var canary=0xdeadbeefcafe;var j_lm=((canary&0xffffff)==0xefcafe);function BigInteger(a,b,c){if(a!=null)
if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b);}
function nbi(){return new BigInteger(null);}
function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/0x4000000);w[j++]=v&0x3ffffff;}
return c;}
function am2(i,x,w,j,c,n){var xl=x&0x7fff,xh=x>>15;while(--n>=0){var l=this[i]&0x7fff;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&0x7fff)<<15)+w[j]+(c&0x3fffffff);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&0x3fffffff;}
return c;}
function am3(i,x,w,j,c,n){var xl=x&0x3fff,xh=x>>14;while(--n>=0){var l=this[i]&0x3fff;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&0x3fff)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&0xfffffff;}
return c;}
if(j_lm&&(navigator.appName=="Microsoft Internet Explorer")){BigInteger.prototype.am=am2;dbits=30;}
else if(j_lm&&(navigator.appName!="Netscape")){BigInteger.prototype.am=am1;dbits=26;}
else{BigInteger.prototype.am=am3;dbits=28;}
BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=((1<<dbits)-1);BigInteger.prototype.DV=(1<<dbits);var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array();var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n);}
function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return(c==null)?-1:c;}
function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s;}
function bnpFromInt(x){this.t=1;this.s=(x<0)?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0;}
function nbv(i){var r=nbi();r.fromInt(i);return r;}
function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return;}
this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=(k==8)?s[i]&0xff:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue;}
mi=false;if(sh==0)
this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&((1<<(this.DB-sh))-1))<<sh;this[this.t++]=(x>>(this.DB-sh));}
else
this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB;}
if(k==8&&(s[0]&0x80)!=0){this.s=-1;if(sh>0)this[this.t-1]|=((1<<(this.DB-sh))-1)<<sh;}
this.clamp();if(mi)BigInteger.ZERO.subTo(this,this);}
function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t;}
function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-(i*this.DB)%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d);}
while(i>=0){if(p<k){d=(this[i]&((1<<p)-1))<<(k-p);d|=this[--i]>>(p+=this.DB-k);}
else{d=(this[i]>>(p-=k))&km;if(p<=0){p+=this.DB;--i;}}
if(d>0)m=true;if(m)r+=int2char(d);}}
return m?r:"0";}
function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r;}
function bnAbs(){return(this.s<0)?this.negate():this;}
function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0;}
function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16;}
if((t=x>>8)!=0){x=t;r+=8;}
if((t=x>>4)!=0){x=t;r+=4;}
if((t=x>>2)!=0){x=t;r+=2;}
if((t=x>>1)!=0){x=t;r+=1;}
return r;}
function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM));}
function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s;}
function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s;}
function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=(this.s<<bs)&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=(this[i]>>cbs)|c;c=(this[i]&bm)<<bs;}
for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp();}
function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return;}
var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs;}
if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp();}
function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB;}
if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB;}
c+=this.s;}
else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB;}
c-=a.s;}
r.s=(c<0)?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp();}
function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r);}
function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1;}}
if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp();}
function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return;}
if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r);}
else{pm.copyTo(y);pt.copyTo(r);}
var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+((ys>1)?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=(q==null)?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r);}
BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=(r[--i]==y0)?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r);}}
if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q);}
r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r);}
function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r;}
function Classic(m){this.m=m;}
function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x;}
function cRevert(x){return x;}
function cReduce(x){x.divRemTo(this.m,null,x);}
function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r);}
function cSqrTo(x,r){x.squareTo(r);this.reduce(r);}
Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=(y*(2-(x&0xf)*y))&0xf;y=(y*(2-(x&0xff)*y))&0xff;y=(y*(2-(((x&0xffff)*y)&0xffff)))&0xffff;y=(y*(2-x*y%this.DV))%this.DV;return(y>0)?this.DV-y:-y;}
function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&0x7fff;this.mph=this.mp>>15;this.um=(1<<(m.DB-15))-1;this.mt2=2*m.t;}
function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r;}
function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r;}
function montReduce(x){while(x.t<=this.mt2)
x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&0x7fff;var u0=(j*this.mpl+(((j*this.mph+(x[i]>>15)*this.mpl)&this.um)<<15))&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++;}}
x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x);}
function montSqrTo(x,r){x.squareTo(r);this.reduce(r);}
function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r);}
Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return((this.t>0)?(this[0]&1):this.s)==0;}
function bnpExp(e,z){if(e>0xffffffff||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&(1<<i))>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t;}}
return z.revert(r);}
function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z);}
BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r;}
function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1;}
else if(this.t==1)return this[0];else if(this.t==0)return 0;return((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0];}
function bnByteValue(){return(this.t==0)?this.s:(this[0]<<24)>>24;}
function bnShortValue(){return(this.t==0)?this.s:(this[0]<<16)>>16;}
function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r));}
function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||(this.t==1&&this[0]<=0))return 0;else return 1;}
function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z);}
return z.intValue().toString(b)+r;}
function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue;}
w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0;}}
if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0);}
if(mi)BigInteger.ZERO.subTo(this,this);}
function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))
this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this);}}}
else{var x=new Array(),t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=((1<<t)-1);else x[0]=0;this.fromString(x,256);}}
function bnToByteArray(){var i=this.t,r=new Array();r[0]=this.s;var p=this.DB-(i*this.DB)%8,d,k=0;if(i-->0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)
r[k++]=d|(this.s<<(this.DB-p));while(i>=0){if(p<8){d=(this[i]&((1<<p)-1))<<(8-p);d|=this[--i]>>(p+=this.DB-8);}
else{d=(this[i]>>(p-=8))&0xff;if(p<=0){p+=this.DB;--i;}}
if((d&0x80)!=0)d|=-256;if(k==0&&(this.s&0x80)!=(d&0x80))++k;if(k>0||d!=this.s)r[k++]=d;}}
return r;}
function bnEquals(a){return(this.compareTo(a)==0);}
function bnMin(a){return(this.compareTo(a)<0)?this:a;}
function bnMax(a){return(this.compareTo(a)>0)?this:a;}
function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t;}
else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t;}
r.s=op(this.s,a.s);r.clamp();}
function op_and(x,y){return x&y;}
function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r;}
function op_or(x,y){return x|y;}
function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r;}
function op_xor(x,y){return x^y;}
function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r;}
function op_andnot(x,y){return x&~y;}
function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r;}
function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r;}
function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r;}
function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r;}
function lbit(x){if(x==0)return-1;var r=0;if((x&0xffff)==0){x>>=16;r+=16;}
if((x&0xff)==0){x>>=8;r+=8;}
if((x&0xf)==0){x>>=4;r+=4;}
if((x&3)==0){x>>=2;r+=2;}
if((x&1)==0)++r;return r;}
function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)
if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1;}
function cbit(x){var r=0;while(x!=0){x&=x-1;++r;}
return r;}
function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r;}
function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return(this.s!=0);return((this[j]&(1<<(n%this.DB)))!=0);}
function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r;}
function bnSetBit(n){return this.changeBit(n,op_or);}
function bnClearBit(n){return this.changeBit(n,op_andnot);}
function bnFlipBit(n){return this.changeBit(n,op_xor);}
function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB;}
if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB;}
c+=this.s;}
else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB;}
c+=a.s;}
r.s=(c<0)?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp();}
function bnAdd(a){var r=nbi();this.addTo(a,r);return r;}
function bnSubtract(a){var r=nbi();this.subTo(a,r);return r;}
function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r;}
function bnSquare(){var r=nbi();this.squareTo(r);return r;}
function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r;}
function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r;}
function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r);}
function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp();}
function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w];}}
function NullExp(){}
function nNop(x){return x;}
function nMulTo(x,y,r){x.multiplyTo(y,r);}
function nSqrTo(x,r){x.squareTo(r);}
NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp());}
function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp();}
function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)
r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r);}
function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m;}
function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r;}}
function barrettRevert(x){return x;}
function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp();}
this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x);}
function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r);}
function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r);}
Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)
z=new Classic(m);else if(m.isEven())
z=new Barrett(m);else
z=new Montgomery(m);var g=new Array(),n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2;}}
var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=(e[j]>>(i-k1))&km;else{w=(e[j]&((1<<(i+1))-1))<<(k1-i);if(j>0)w|=e[j-1]>>(this.DB+i-k1);}
n=k;while((w&1)==0){w>>=1;--n;}
if((i-=n)<0){i+=this.DB;--j;}
if(is1){g[w].copyTo(r);is1=false;}
else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2;}
if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t;}
z.mulTo(r2,g[w],r);}
while(j>=0&&(e[j]&(1<<i))==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j;}}}
return z.revert(r);}
function bnGCD(a){var x=(this.s<0)?this.negate():this.clone();var y=(a.s<0)?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t;}
var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y);}
while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x);}
else{y.subTo(x,y);y.rShiftTo(1,y);}}
if(g>0)y.lShiftTo(g,y);return y;}
function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=(this.s<0)?n-1:0;if(this.t>0)
if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r;}
function bnModInverse(m){var ac=m.isEven();if((this.isEven()&&ac)||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b);}
a.rShiftTo(1,a);}
else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b);}
while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d);}
c.rShiftTo(1,c);}
else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d);}
if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b);}
else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d);}}
if(v.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d;}
var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)
if(x[0]==lowprimes[i])return true;return false;}
if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false;}
return x.millerRabin(t);}
function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=(t+1)>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return false;}
if(y.compareTo(n1)!=0)return false;}}
return true;}
BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;return BigInteger;}());Otr.SecureRandom=(function(){function Arcfour(){this.i=0;this.j=0;this.S=new Array();}
function ARC4init(key){var i,j,t;for(i=0;i<256;++i)
this.S[i]=i;j=0;for(i=0;i<256;++i){j=(j+this.S[i]+key[i%key.length])&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t;}
this.i=0;this.j=0;}
function ARC4next(){var t;this.i=(this.i+1)&255;this.j=(this.j+this.S[this.i])&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[(t+this.S[this.i])&255];}
Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour();}
var rng_psize=256;var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255;rng_pool[rng_pptr++]^=(x>>8)&255;rng_pool[rng_pptr++]^=(x>>16)&255;rng_pool[rng_pptr++]^=(x>>24)&255;if(rng_pptr>=rng_psize)rng_pptr-=rng_psize;}
function rng_seed_time(){rng_seed_int(new Date().getTime());}
if(rng_pool==null){rng_pool=new Array();rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)
rng_pool[rng_pptr++]=z.charCodeAt(t)&255;}
while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255;}
rng_pptr=0;rng_seed_time();}
function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)
rng_pool[rng_pptr]=0;rng_pptr=0;}
return rng_state.next();}
function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i)ba[i]=rng_get_byte();}
function SecureRandom(){}
SecureRandom.prototype.nextBytes=rng_get_bytes;SecureRandom.seedTime=rng_seed_time;return SecureRandom;}());Otr.BigInteger.generate=function(x){return Otr.BigInteger.ONE.shiftLeft(x-1).add(new Otr.BigInteger(x-1,new Otr.SecureRandom()));};Otr.BigInteger.fromMagnitude=function(sign,bytes){var b=bytes.slice(0);switch(sign){case 0:return new Otr.BigInteger('0');case 1:b.unshift(0);return new Otr.BigInteger(b);case-1:b[0]=256-(b[0]&0xFF);b.unshift(-1);return new Otr.BigInteger(b);default:return new Otr.BigInteger(b);}};
Otr.Type=(function(){"use strict";function Data(x){this.value=x;}
Data.prototype={value:[],getLength:function(){return this.value.length;},getValue:function(){return this.value;},equals:function(d){var i,len=this.getLength();if(this.getLength()!==d.getLength())return false;for(i=0;i<len;++i){if(this.value[i]!==d.value[i])return false;}
return true;},toBytes:function(){var bytes=this.value.slice(0),len=this.getLength();bytes.unshift((len>>24)&0xFF,(len>>16)&0xFF,(len>>8)&0xFF,(len)&0xFF);return bytes;}};function MPI(x){if(x instanceof Otr.BigInteger){this.value=x.toByteArray();}else{this.value=x;}
while(this.value[0]===0){this.value.shift();}}
MPI.prototype={value:[],getLength:function(){return this.value.length;},getValue:function(){return this.value;},equals:function(m){var i,len=this.getLength();if(this.getLength()!==m.getLength())return false;for(i=0;i<len;++i){if(this.value[i]!==m.value[i])return false;}
return true;},compareTo:function(mpi){return this.toBigInteger().compareTo(mpi.toBigInteger());},toBytes:function(){var bytes=this.value.slice(0),len=this.getLength();bytes.unshift((len>>24)&0xFF,(len>>16)&0xFF,(len>>8)&0xFF,(len)&0xFF);return bytes;},toBigInteger:function(){return Otr.BigInteger.fromMagnitude(1,this.value);}};function Pubkey(p,q,g,y){this.p=p;this.q=q;this.g=g;this.y=y;}
Pubkey.prototype={type:0x0000,toBytes:function(){var bytes=[];bytes.push((this.type>>8)&0xFF);bytes.push(this.type&0xFF);bytes=bytes.concat(this.p.toBytes(),this.q.toBytes(),this.g.toBytes(),this.y.toBytes());return bytes;}};Pubkey.readPubkey=function(buf){var type=buf.readShort(),p=buf.readMPI(),q=buf.readMPI(),g=buf.readMPI(),y=buf.readMPI();return new Pubkey(p,q,g,y);};function Sig(r,s){this.r=r;this.s=s;}
Sig.prototype={toBytes:function(){var bar=this.r.toByteArray(),bas=this.s.toByteArray();while(bar[0]===0)bar.shift();while(bar.length<20)bar.unshift(0x00);while(bas[0]===0)bas.shift();while(bas.length<20)bas.unshift(0x00);return bar.concat(bas);}};Sig.readSig=function(buf){var r=buf.readBytes(20),s=buf.readBytes(20);return new Sig(Otr.BigInteger.fromMagnitude(1,r),Otr.BigInteger.fromMagnitude(1,s));};function TLV(type,len,val){this.type=type;this.len=len;this.val=val;}
TLV.prototype={};TLV.PADDING=0;TLV.DISCONNECTED=1;TLV.readTLV=function(buf){var type=buf.readShort(),len=buf.readShort(),val=buf.readBytes(len);return new TLV(type,len,val);};var Type={Data:Data,MPI:MPI,Pubkey:Pubkey,Sig:Sig,TLV:TLV};return Type;}());
Otr.ByteBuffer=(function(){"use strict";var b64array="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ByteBuffer(data){this.data=(typeof data!=="undefined")?data:'';}
ByteBuffer.prototype={data:'',pos:0,readByte:function(){return(this.data.charCodeAt(this.pos++)&0xFF);},writeByte:function(b){this.data+=String.fromCharCode(b&0xFF);this.pos++;},readShort:function(){var data=this.data,pos=(this.pos+=2)-2;return((data.charCodeAt(pos)&0xFF)<<8)|(data.charCodeAt(++pos)&0xFF);},writeShort:function(x){this.data+=String.fromCharCode((x>>8)&0xFF,(x)&0xFF);this.pos+=2;},readUInt:function(){var data=this.data,pos=(this.pos+=4)-4;var x=((data.charCodeAt(pos)&0xFF)<<24)|((data.charCodeAt(++pos)&0xFF)<<16)|((data.charCodeAt(++pos)&0xFF)<<8)|(data.charCodeAt(++pos)&0xFF);return(x<0)?x+4294967296:x;},writeUInt:function(x){this.data+=String.fromCharCode((x>>24)&0xFF,(x>>16)&0xFF,(x>>8)&0xFF,(x)&0xFF);this.pos+=4;},readBytes:function(length){var x=[];while(length--){x.push(this.readByte());}
return x;},writeBytes:function(bytes,length){var i;length=length||bytes.length;for(i=0;i<length;++i){this.writeByte(bytes[i]);}},readData:function(){var len=this.readUInt(),bytes=this.readBytes(len);return new Otr.Type.Data(bytes);},writeData:function(data){var len=data.getLength();this.writeUInt(len);this.writeBytes(data.getValue(),len);},readMPI:function(){var len=this.readUInt(),bytes=this.readBytes(len);return new Otr.Type.MPI(bytes);},writeMPI:function(mpi){var len=mpi.getLength();this.writeUInt(len);this.writeBytes(mpi.getValue(),len);},reset:function(){this.pos=0;},getLength:function(){return this.data.length;},byteAt:function(i){return this.data.charCodeAt(i)&0xFF;},equals:function(b){if(this.getLength()!==b.getLength())return false;var thisprev=this.pos,bprev=b.pos,len=this.getLength();this.reset();b.reset();while(len--){if(this.readByte()!==b.readByte()){this.pos=thisprev;b.pos=bprev;return false;}}
this.pos=thisprev;b.pos=bprev;return true;},toByteArray:function(){var arr=[],len=this.getLength(),prevpos=this.pos;this.reset();while(len--){arr.push(this.readByte());}
this.pos=prevpos;return arr;},toWordArray:function(){var arr=[],len=this.getLength(),prevpos=this.pos;this.reset();while(len>0){arr.push(this.readUInt());len-=4;}
this.pos=prevpos;return CryptoJS.lib.WordArray.create(arr,this.getLength());},toBase64:function(){var input=this.data,base64="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;do{chr1=input.charCodeAt(i++);if(!isNaN(chr1))chr1&=0xFF;chr2=input.charCodeAt(i++);if(!isNaN(chr2))chr2&=0xFF;chr3=input.charCodeAt(i++);if(!isNaN(chr3))chr3&=0xFF;enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
base64=base64+
b64array.charAt(enc1)+
b64array.charAt(enc2)+
b64array.charAt(enc3)+
b64array.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4="";}while(i<input.length);return base64;},toString:function(){return this.data;}};ByteBuffer.fromByteArray=function(arr){var ba=new ByteBuffer(),i,l;for(i=0,l=arr.length;i<l;i++){ba.writeByte(arr[i]);}
ba.reset();return ba;};ByteBuffer.fromBase64=function(input){var output="",chr1,chr2,chr3,enc1,enc2,enc3,enc4,i=0;do{enc1=b64array.indexOf(input.charAt(i++));enc2=b64array.indexOf(input.charAt(i++));enc3=b64array.indexOf(input.charAt(i++));enc4=b64array.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}
chr1=chr2=chr3="";enc1=enc2=enc3=enc4="";}while(i<input.length);return new ByteBuffer(output);};return ByteBuffer;}());
Otr.Message=(function(){"use strict";function Message(msg){var matches,bytebuff;if(!msg.match(/^\?OTR/)){this.type=Message.MSG_PLAIN;this.message=msg;}else if(msg==='?OTRv2?'){this.type=Message.MSG_QUERY;this.message=msg;}else if(matches=msg.match(/^\?OTR Error:(.*)$/)){this.type=Message.MSG_ERROR;this.message=matches[1];}else if(matches=msg.match(/^\?OTR:([a-zA-Z0-9+/]+={0,2})\.$/)){bytebuff=Otr.ByteBuffer.fromBase64(matches[1]);this.version=bytebuff.readShort();this.type=bytebuff.readByte();switch(this.type){case Message.MSG_DH_COMMIT:this.dataEncryptedGx=bytebuff.readData();this.dataHashedGx=bytebuff.readData();break;case Message.MSG_DH_KEY:this.mpiGy=bytebuff.readMPI();break;case Message.MSG_REVEAL_SIGNATURE:this.dataRevealedKey=bytebuff.readData();this.dataEncryptedSignature=bytebuff.readData();this.macSignature=bytebuff.readBytes(20);break;case Message.MSG_SIGNATURE:this.dataEncryptedSignature=bytebuff.readData();this.macSignature=bytebuff.readBytes(20);break;case Message.MSG_DATA:this.byteFlags=bytebuff.readByte();this.intSenderKeyid=bytebuff.readUInt();this.intRecipientKeyid=bytebuff.readUInt();this.mpiDHy=bytebuff.readMPI();this.ctr=bytebuff.readBytes(8);this.dataEncryptedMessage=bytebuff.readData();this.macAuthenticator=bytebuff.readBytes(20);this.dataOldMacKeys=bytebuff.readData();break;default:this.type=Message.MSG_UNKNOWN;this.message=msg;}}else{this.type=Message.MSG_UNKNOWN;this.message=msg;}}
Message.MSG_UNKNOWN=-99;Message.MSG_QUERY=-1;Message.MSG_ERROR=-2;Message.MSG_PLAIN=-3;Message.MSG_DH_COMMIT=0x02;Message.MSG_DH_KEY=0x0a;Message.MSG_REVEAL_SIGNATURE=0x11;Message.MSG_SIGNATURE=0x12;Message.MSG_DATA=0x03;Message.prototype={type:0,version:2,message:'',toString:function(){var bytebuff=new Otr.ByteBuffer();bytebuff.writeShort(this.version);bytebuff.writeByte(this.type);switch(this.type){case Message.MSG_ERROR:return'?OTR Error:'+this.message;case Message.MSG_DH_COMMIT:bytebuff.writeData(this.dataEncryptedGx);bytebuff.writeData(this.dataHashedGx);break;case Message.MSG_DH_KEY:bytebuff.writeMPI(this.mpiGy);break;case Message.MSG_REVEAL_SIGNATURE:bytebuff.writeData(this.dataRevealedKey);bytebuff.writeData(this.dataEncryptedSignature);bytebuff.writeBytes(this.macSignature,20);break;case Message.MSG_SIGNATURE:bytebuff.writeData(this.dataEncryptedSignature);bytebuff.writeBytes(this.macSignature,20);break;case Message.MSG_DATA:bytebuff.writeByte(this.byteFlags);bytebuff.writeUInt(this.intSenderKeyid);bytebuff.writeUInt(this.intRecipientKeyid);bytebuff.writeMPI(this.mpiDHy);bytebuff.writeBytes(this.ctr,8);bytebuff.writeData(this.dataEncryptedMessage);bytebuff.writeBytes(this.macAuthenticator,20);bytebuff.writeData(this.dataOldMacKeys);break;default:return this.message;}
return'?OTR:'+(bytebuff.toBase64())+'.';}};return Message;}());
Otr.DSA=(function(){"use strict";var BigInteger=Otr.BigInteger,Util=Otr.Util,log=true;function arraycopy(fromar,fromi,toar,toi,howmany){for(var i=fromi,j=toi,k=0;k<howmany;++i,++j,++k){toar[j]=fromar[i];}}
function DSA(){}
DSA.prototype={certainty:20,rand:new Otr.SecureRandom(),L:1024,N:160,H:function(bytes){var words=CryptoJS.SHA1(Otr.Util.byteArrayToWordArray(bytes));return Otr.Util.wordArrayToByteArray(words);},q:null,p:null,g:null,y:null,x:null,k:null,generateParameters:function(){var start,end;start=new Date().getTime();try{this._generatePQ();}catch(e){if(log)end=new Date().getTime();if(log)console.log('generate params: '+(end-start)+'ms');throw e;}
if(log)console.log('q: '+this.q.toString(16));if(log)console.log('p: '+this.p.toString(16));this.g=this._generateG(this.p,this.q);if(log)console.log('g: '+this.g.toString(16));if(log)end=new Date().getTime();if(log)console.log('generate params: '+(end-start)+'ms');},generateKey:function(){do{this.x=new BigInteger(this.q.bitCount(),this.rand);}while((this.x.compareTo(BigInteger.ZERO)<=0)||(this.x.compareTo(this.q)>=0));this.y=Util.powMod(this.g,this.x,this.p);},_generatePQ:function(){function inc(buf){var i,b;for(i=buf.length-1;i>=0;--i){b=((buf[i]+1)&0xff);buf[i]=b;if(b!=0){break;}}}
function logit(msg,start){var end=new Date().getTime();console.log(msg+': '+(end-start)+'ms');return(end-start);}
var seed=new Array(20),part1,part2,offset,u=new Array(20),i,counter,k,q,p,n=6,w=new Array(128),x,c;var bigloop=0;for(;;){if(log)console.log('bigloop:'+(++bigloop));this.rand.nextBytes(seed);part1=this.H(seed);part2=seed.slice(0);inc(part2);part2=this.H(part2);for(i=0;i!=u.length;i++){u[i]=part1[i]^part2[i];}
u[0]|=0x80;u[19]|=0x01;q=BigInteger.fromMagnitude(1,u);if(!q.isProbablePrime(this.certainty)){continue;}
offset=seed.slice(0);inc(offset);for(counter=0;counter<4096;++counter){for(k=0;k<n;k++){inc(offset);part1=this.H(offset);arraycopy(part1,0,w,w.length-(k+1)*part1.length,part1.length);}
inc(offset);part1=this.H(offset);arraycopy(part1,part1.length-((w.length-(n)*part1.length)),w,0,w.length-n*part1.length);w[0]|=0x80;x=BigInteger.fromMagnitude(1,w);c=x.mod(q.shiftLeft(1));p=x.subtract(c.subtract(BigInteger.ONE));if(p.bitLength()!=this.L){continue;}
if(p.isProbablePrime(this.certainty)){if(log)console.log('found at counter:'+counter);this.p=p;this.q=q;return;}}
if(log)console.log('counter over 4096');}},_generateG:function(p,q){var aux=p.subtract(BigInteger.ONE),pow=aux.divide(q),gTemp;do{gTemp=new BigInteger(aux.bitLength(),this.rand);}while(gTemp.compareTo(aux)>=0||gTemp.compareTo(BigInteger.ONE)<=0);return Util.powMod(gTemp,pow,p);},generateSignature:function(message){var k,r,s,h;do{k=new BigInteger(this.q.bitLength(),this.rand);}while(k.compareTo(this.q)>=0&&k.compareTo(BigInteger.ZERO)<=0);r=Util.powMod(this.g,k,this.p).mod(this.q);h=BigInteger.fromMagnitude(1,message);s=(k.modInverse(this.q).multiply(h.add(this.x.multiply(r)))).mod(this.q);return{r:r,s:s};},verifySignature:function(message,r,s){var v,hash,w,u1,u2;if(r.compareTo(BigInteger.ZERO)<=0||r.compareTo(this.q)>=0){return false;}
if(s.compareTo(BigInteger.ZERO)<=0||s.compareTo(this.q)>=0){return false;}
hash=BigInteger.fromMagnitude(1,message);w=s.modInverse(this.q);u1=hash.multiply(w).mod(this.q);u2=r.multiply(w).mod(this.q);v=((Util.powMod(this.g,u1,this.p).multiply(Util.powMod(this.y,u2,this.p))).mod(this.p)).mod(this.q);return v.compareTo(r)==0;},clone:function(){var k,d=new DSA();for(k in d){if(this[k]instanceof BigInteger){d[k]=this[k].clone();}}
return d;}};return DSA;}());
Otr.Auth=(function(){"use strict";var Message=Otr.Message,BigInteger=Otr.BigInteger,Util=Otr.Util,Type=Otr.Type,ByteBuffer=Otr.ByteBuffer,DH_G=new BigInteger('2'),DH_MOD=new BigInteger("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DD"+"EF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7ED"+"EE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F"+"83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA237327FFFFFFFFFFFFFFFF",16),DH_MOD_MIN_2=new BigInteger("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DD"+"EF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7ED"+"EE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F"+"83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA237327FFFFFFFFFFFFFFFD",16),TWO=new BigInteger('2'),CTR_ZERO=Util.createIV(128),AUTHSTATE_NONE=0,AUTHSTATE_AWAITING_DHKEY=1,AUTHSTATE_AWAITING_REVEALSIG=2,AUTHSTATE_AWAITING_SIG=3,AUTHSTATE_V1_SETUP=4;function generateDHKey(){var biX=BigInteger.generate(320),biGx=Util.powMod(DH_G,biX,DH_MOD),mpiGx=new Type.MPI(biGx);return{biPrivate:biX,mpiPublic:mpiGx};}
var stime={};function log_start(text){stime[text]=new Date().getTime();}
function log_end(text){var ms=new Date().getTime()-stime[text];if(console)console.log(text+': '+ms+'ms');}
function Auth(myId,targetId,dsa){this.myId=myId;this.targetId=targetId;this.dsa=dsa.clone();this.dsa.generateKey();this.pubkey=new Type.Pubkey(new Type.MPI(this.dsa.p),new Type.MPI(this.dsa.q),new Type.MPI(this.dsa.g),new Type.MPI(this.dsa.y));}
Auth.prototype={state:AUTHSTATE_NONE,encrypted:false,reply:false,secret:{},theirPubkey:null,keyManager:null,finished:false,produceQueryMessage:function(){var msg=new Message('?OTRv2?');return msg;},consumeQueryMessage:function(msg){this.reply=this.produceDHCommitMessage();this.state=AUTHSTATE_AWAITING_DHKEY;},produceDHCommitMessage:function(){var msg=new Message(''),biR=BigInteger.generate(128),dhkey=generateDHKey(),biX=dhkey.biPrivate,mpiGx=dhkey.mpiPublic,waGxmpi,waR,encGx,waHashgx;waGxmpi=Util.byteArrayToWordArray(mpiGx.toBytes());waR=CryptoJS.enc.Hex.parse(biR.toString(16));encGx=CryptoJS.AES.encrypt(waGxmpi,waR,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});waHashgx=CryptoJS.SHA256(waGxmpi);msg.type=Message.MSG_DH_COMMIT;msg.dataEncryptedGx=new Type.Data(Util.wordArrayToByteArray(encGx.ciphertext));msg.dataHashedGx=new Type.Data(Util.wordArrayToByteArray(waHashgx));this.secret.biX=biX;this.secret.mpiR=new Type.MPI(biR);this.secret.mpiGx=mpiGx;return msg;},consumeDHCommitMessage:function(msg){switch(this.state){case AUTHSTATE_NONE:case AUTHSTATE_AWAITING_SIG:this.secret.dataEncryptedGx=msg.dataEncryptedGx;this.secret.dataHashedGx=msg.dataHashedGx;this.reply=this.produceDHKeyMessage();this.state=AUTHSTATE_AWAITING_REVEALSIG;break;case AUTHSTATE_AWAITING_DHKEY:break;case AUTHSTATE_AWAITING_REVEALSIG:break;}},produceDHKeyMessage:function(){var msg=new Message(''),dhkey=generateDHKey(),biY=dhkey.biPrivate;msg.type=Message.MSG_DH_KEY;msg.mpiGy=dhkey.mpiPublic;this.secret.biY=biY;this.secret.mpiGy=msg.mpiGy;return msg;},consumeDHKeyMessage:function(msg){switch(this.state){case AUTHSTATE_AWAITING_DHKEY:this.secret.mpiGy=msg.mpiGy;this.reply=this.produceRevealSignatureMessage();this.state=AUTHSTATE_AWAITING_SIG;break;case AUTHSTATE_AWAITING_SIG:break;default:}},_generateAuthKeys:function(biS){var seed=new Type.MPI(biS).toBytes(),waTemp,waSsid,waC,waCp,waM1,waM1p,waM2,waM2p;seed.unshift(0x00);function h2(b){seed[0]=b;return CryptoJS.SHA256(Util.byteArrayToWordArray(seed));}
waSsid=h2(0x00);waSsid.sigBytes=8;waTemp=h2(0x01);waC=CryptoJS.lib.WordArray.create(waTemp.words.slice(0,4),16);waCp=CryptoJS.lib.WordArray.create(waTemp.words.slice(4,8),16);waM1=h2(0x02);waM2=h2(0x03);waM1p=h2(0x04);waM2p=h2(0x05);return{ssid:waSsid,c:waC,cp:waCp,m1:waM1,m1p:waM1p,m2:waM2,m2p:waM2p};},_computeM:function(mpiG1,mpiG2,pubkey,keyid,waKey){var buf=new ByteBuffer(),waHmac;buf.writeMPI(mpiG1);buf.writeMPI(mpiG2);buf.writeBytes(pubkey.toBytes());buf.writeUInt(keyid);waHmac=CryptoJS.HmacSHA256(buf.toWordArray(),waKey);return waHmac;},_computeX:function(pubkey,keyid,dsa,waM){var buf=new ByteBuffer(),sign,sigX;buf.writeBytes(pubkey.toBytes());buf.writeUInt(keyid);sign=dsa.generateSignature(Util.wordArrayToByteArray(waM));sigX=new Type.Sig(sign.r,sign.s);buf.writeBytes(sigX.toBytes());return buf.toWordArray();},produceRevealSignatureMessage:function(){var biTemp,biS,waKeys,keyidB,waMB,waXB,encSign,dataEncSign,waHmac,msg=new Message('');biTemp=this.secret.mpiGy.toBigInteger();if(biTemp.compareTo(TWO)<0||biTemp.compareTo(DH_MOD_MIN_2)>0)throw new Error('Invalid Gy received');biS=Util.powMod(this.secret.mpiGy.toBigInteger(),this.secret.biX,DH_MOD);waKeys=this._generateAuthKeys(biS);keyidB=1;waMB=this._computeM(this.secret.mpiGx,this.secret.mpiGy,this.pubkey,keyidB,waKeys.m1);waXB=this._computeX(this.pubkey,keyidB,this.dsa,waMB);encSign=CryptoJS.AES.encrypt(waXB,waKeys.c,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});dataEncSign=new Type.Data(Util.wordArrayToByteArray(encSign.ciphertext));waHmac=CryptoJS.HmacSHA256(Util.byteArrayToWordArray(dataEncSign.toBytes()),waKeys.m2);waHmac.sigBytes=20;this.secret.waKeys=waKeys;this.secret.biS=biS;this.secret.keyidB=keyidB;msg.type=Message.MSG_REVEAL_SIGNATURE;msg.dataRevealedKey=new Type.Data(this.secret.mpiR.getValue());msg.dataEncryptedSignature=dataEncSign;msg.macSignature=Util.wordArrayToByteArray(waHmac);return msg;},consumeRevealSignatureMessage:function(msg){switch(this.state){case AUTHSTATE_AWAITING_REVEALSIG:this.secret.dataRevealedKey=msg.dataRevealedKey;this.secret.dataEncryptedSignature=msg.dataEncryptedSignature;this.secret.macSignature=msg.macSignature;this.reply=this.produceSignatureMessage();this.state=AUTHSTATE_NONE;this.encrypted=true;break;default:}},produceSignatureMessage:function(){var waR,encGx,waGxmpi,waHashgx,biGx,biS,waKeys,waHmac,encSign,waXB,pubB,keyidB,sigB,mpiGx,waMB,dsaVerify,keyidA,waMA,waXA,encSign,dataEncSign,waHmac,buf,msg=new Message('');waR=Util.byteArrayToWordArray(this.secret.dataRevealedKey.getValue());encGx=CryptoJS.lib.CipherParams.create({ciphertext:Util.byteArrayToWordArray(this.secret.dataEncryptedGx.getValue())});waGxmpi=CryptoJS.AES.decrypt(encGx,waR,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});Util.correctWordsLength(waGxmpi);waHashgx=CryptoJS.SHA256(waGxmpi);if(!Util.bytesEqual(this.secret.dataHashedGx.getValue(),Util.wordArrayToByteArray(waHashgx)))throw new Error('HASH(gx) not match');biGx=new Type.MPI(Util.wordArrayToByteArray(waGxmpi).slice(4)).toBigInteger();if(biGx.compareTo(TWO)<0||biGx.compareTo(DH_MOD_MIN_2)>0)throw new Error('Invalid Gx received');biS=Util.powMod(biGx,this.secret.biY,DH_MOD);waKeys=this._generateAuthKeys(biS);waHmac=CryptoJS.HmacSHA256(Util.byteArrayToWordArray(this.secret.dataEncryptedSignature.toBytes()),waKeys.m2);waHmac.sigBytes=20;if(!Util.bytesEqual(this.secret.macSignature,Util.wordArrayToByteArray(waHmac)))throw new Error('Invalid MAC-ed signature');encSign=CryptoJS.lib.CipherParams.create({ciphertext:Util.byteArrayToWordArray(this.secret.dataEncryptedSignature.getValue())});waXB=CryptoJS.AES.decrypt(encSign,waKeys.c,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});buf=ByteBuffer.fromByteArray(Util.wordArrayToByteArray(waXB));pubB=Type.Pubkey.readPubkey(buf);keyidB=buf.readUInt();sigB=Type.Sig.readSig(buf);mpiGx=new Type.MPI(biGx);waMB=this._computeM(mpiGx,this.secret.mpiGy,pubB,keyidB,waKeys.m1);dsaVerify=new Otr.DSA();dsaVerify.p=pubB.p.toBigInteger();dsaVerify.q=pubB.q.toBigInteger();dsaVerify.g=pubB.g.toBigInteger();dsaVerify.y=pubB.y.toBigInteger();if(!dsaVerify.verifySignature(Util.wordArrayToByteArray(waMB),sigB.r,sigB.s))throw new Error('pubB verify signature failed');keyidA=1;waMA=this._computeM(this.secret.mpiGy,mpiGx,this.pubkey,keyidA,waKeys.m1p);waXA=this._computeX(this.pubkey,keyidA,this.dsa,waMA);encSign=CryptoJS.AES.encrypt(waXA,waKeys.cp,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});dataEncSign=new Type.Data(Util.wordArrayToByteArray(encSign.ciphertext));waHmac=CryptoJS.HmacSHA256(Util.byteArrayToWordArray(dataEncSign.toBytes()),waKeys.m2p);waHmac.sigBytes=20;this.theirPubkey=pubB;this.keyManager=new KeyManager(this.secret.biY,this.secret.mpiGy,mpiGx);this.secret={};msg.type=Message.MSG_SIGNATURE;msg.dataEncryptedSignature=dataEncSign;msg.macSignature=Util.wordArrayToByteArray(waHmac);return msg;},consumeSignatureMessage:function(msg){switch(this.state){case AUTHSTATE_AWAITING_SIG:this.secret.dataEncryptedSignature=msg.dataEncryptedSignature;this.secret.macSignature=msg.macSignature;this.verifySignatureMessage(msg);this.state=AUTHSTATE_NONE;this.encrypted=true;break;default:}},verifySignatureMessage:function(){var waHmac,encSign,buf,waXA,pubA,keyidA,sigA,waMA,dsaVerify;waHmac=CryptoJS.HmacSHA256(Util.byteArrayToWordArray(this.secret.dataEncryptedSignature.toBytes()),this.secret.waKeys.m2p);waHmac.sigBytes=20;if(!Util.bytesEqual(this.secret.macSignature,Util.wordArrayToByteArray(waHmac)))throw new Error('Invalid MAC-ed signature');encSign=CryptoJS.lib.CipherParams.create({ciphertext:Util.byteArrayToWordArray(this.secret.dataEncryptedSignature.getValue())});waXA=CryptoJS.AES.decrypt(encSign,this.secret.waKeys.cp,{mode:CryptoJS.mode.CTR,iv:CTR_ZERO,padding:CryptoJS.pad.NoPadding});buf=ByteBuffer.fromByteArray(Util.wordArrayToByteArray(waXA));pubA=Type.Pubkey.readPubkey(buf);keyidA=buf.readUInt();sigA=Type.Sig.readSig(buf);waMA=this._computeM(this.secret.mpiGy,this.secret.mpiGx,pubA,keyidA,this.secret.waKeys.m1p);dsaVerify=new Otr.DSA();dsaVerify.p=pubA.p.toBigInteger();dsaVerify.q=pubA.q.toBigInteger();dsaVerify.g=pubA.g.toBigInteger();dsaVerify.y=pubA.y.toBigInteger();if(!dsaVerify.verifySignature(Util.wordArrayToByteArray(waMA),sigA.r,sigA.s))throw new Error('pubA verify signature failed');this.theirPubkey=pubA;this.keyManager=new KeyManager(this.secret.biX,this.secret.mpiGx,this.secret.mpiGy);this.secret={};},_computeT:function(ourkeyid,theirkeyid,nextdh,ctr,encaes){var buf=new ByteBuffer();buf.writeShort(0x02);buf.writeByte(Message.MSG_DATA);buf.writeByte(0x00);buf.writeUInt(ourkeyid);buf.writeUInt(theirkeyid);buf.writeMPI(nextdh);buf.writeBytes(ctr);buf.writeData(encaes);return buf.toWordArray();},produceDataMessage:function(plaintext){if(!this.encrypted)throw new Error("It's not encrypted");var sess,oldmackeys,waT,baMsg,encMsg,dataEncMsg,waHmac,msg=new Message('');sess=this.keyManager.sessKeys[1][0];oldmackeys=new Type.Data(this.keyManager.oldMacKeys());sess.incCtrSend();baMsg=Util.stringToByteArray(plaintext);encMsg=CryptoJS.AES.encrypt(Util.byteArrayToWordArray(baMsg),sess.waSendAesKey,{mode:CryptoJS.mode.CTR,iv:Util.createIV(128,sess.ctrSend),padding:CryptoJS.pad.NoPadding});dataEncMsg=new Type.Data(Util.wordArrayToByteArray(encMsg.ciphertext));waT=this._computeT(this.keyManager.ourKeyid-1,this.keyManager.theirKeyid,this.keyManager.mpiOurY,sess.ctrSend,dataEncMsg);waHmac=CryptoJS.HmacSHA1(waT,sess.waSendMacKey);msg.type=Message.MSG_DATA;msg.byteFlags=0x00;msg.intSenderKeyid=this.keyManager.ourKeyid-1;msg.intRecipientKeyid=this.keyManager.theirKeyid;msg.mpiDHy=this.keyManager.mpiOurY;msg.ctr=sess.ctrSend;msg.dataEncryptedMessage=dataEncMsg;msg.macAuthenticator=Util.wordArrayToByteArray(waHmac);msg.dataOldMacKeys=oldmackeys;return msg;},consumeDataMessage:function(msg){if(!this.encrypted)return this.reply=new Message('?OTR Error:an unreadable encrypted message was received');var difOur,difTheir,sess,waT,waHmac,encMsg,waMsg,baMsg,str,i,buf,tlv;difOur=this.keyManager.ourKeyid-msg.intRecipientKeyid;difTheir=this.keyManager.theirKeyid-msg.intSenderKeyid;sess=this.keyManager.sessKeys[difOur][difTheir];if(!sess)throw new Error('Keyid is not recognized\nOur keyid:'+this.keyManager.ourKeyid+'; Recipient keyid:'+msg.intRecipientKeyid+'\nTheir keyid:'+this.keyManager.theirKeyid+'; Sender keyid:'+msg.intSenderKeyid);waT=this._computeT(msg.intSenderKeyid,msg.intRecipientKeyid,msg.mpiDHy,msg.ctr,msg.dataEncryptedMessage);waHmac=CryptoJS.HmacSHA1(waT,sess.waRecvMacKey);if(!Util.bytesEqual(Util.wordArrayToByteArray(waHmac),msg.macAuthenticator))throw new Error('MAC verification failed');encMsg=CryptoJS.lib.CipherParams.create({ciphertext:Util.byteArrayToWordArray(msg.dataEncryptedMessage.getValue())});waMsg=CryptoJS.AES.decrypt(encMsg,sess.waRecvAesKey,{mode:CryptoJS.mode.CTR,iv:Util.createIV(128,msg.ctr),padding:CryptoJS.pad.NoPadding});baMsg=Util.wordArrayToByteArray(waMsg);str='';i=0;while(i<baMsg.length&&(baMsg[i]!==0)){str+=String.fromCharCode(baMsg[i++]);}
buf=new ByteBuffer();buf.writeBytes(baMsg.slice(i+1));buf.reset();tlv=Type.TLV.readTLV(buf);if(tlv.type===Type.TLV.DISCONNECTED){this.finished=true;}
this.keyManager.processReceivedKey(msg.intRecipientKeyid,msg.intSenderKeyid,msg.mpiDHy);return str;},consumeMessage:function(msg){this.reply=false;switch(msg.type){case Message.MSG_QUERY:this.consumeQueryMessage(msg);break;case Message.MSG_DH_COMMIT:this.consumeDHCommitMessage(msg);break;case Message.MSG_DH_KEY:this.consumeDHKeyMessage(msg);break;case Message.MSG_REVEAL_SIGNATURE:this.consumeRevealSignatureMessage(msg);break;case Message.MSG_SIGNATURE:this.consumeSignatureMessage(msg);break;case Message.MSG_DATA:this.consumeDataMessage(msg);break;default:}},produceDisconnectMessage:function(){return this.produceDataMessage(String.fromCharCode(0,0,1,0,0));},reset:function(){this.state=AUTHSTATE_NONE;this.encrypted=false;this.reply=false;this.secret={};this.finished=false;}};function SessionKeys(biOurDh,mpiOurY,mpiTheirY){var biS=Util.powMod(mpiTheirY.toBigInteger(),biOurDh,DH_MOD),secbytes=new Type.MPI(biS).toBytes(),sendbyte,recvbyte;secbytes.unshift(0x00);function h1(b){secbytes[0]=b;return CryptoJS.SHA1(Util.byteArrayToWordArray(secbytes));}
if(mpiOurY.compareTo(mpiTheirY)>0){sendbyte=0x01;recvbyte=0x02;}else{sendbyte=0x02;recvbyte=0x01;}
this.waSendAesKey=h1(sendbyte);this.waSendAesKey.sigBytes=16;Util.correctWordsLength(this.waSendAesKey);this.waSendMacKey=CryptoJS.SHA1(this.waSendAesKey);this.waRecvAesKey=h1(recvbyte);this.waRecvAesKey.sigBytes=16;Util.correctWordsLength(this.waRecvAesKey);this.waRecvMacKey=CryptoJS.SHA1(this.waRecvAesKey);this.ctrSend=[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00];}
SessionKeys.prototype={incCtrSend:function(){for(var i=7;i>=0;i--){this.ctrSend[i]++;if(this.ctrSend[i]!=0)
break;}}};function KeyManager(biOurDh,mpiOurY,mpiTheirY){var dhkey;this.sessKeys=new Array(2);this.sessKeys[0]=new Array(2);this.sessKeys[1]=new Array(2);this.sessKeys[1][0]=new SessionKeys(biOurDh,mpiOurY,mpiTheirY);dhkey=generateDHKey();this.sessKeys[0][0]=new SessionKeys(dhkey.biPrivate,dhkey.mpiPublic,mpiTheirY);this.sessKeys[0][1]=null;this.sessKeys[1][1]=null;this.ourKeyid=2;this.theirKeyid=1;this.biOurDhKey=dhkey.biPrivate;this.biOurOldDhKey=biOurDh;this.mpiOurY=dhkey.mpiPublic;this.mpiOurOldY=mpiOurY;this.mpiTheirY=mpiTheirY;this.mpiTheirOldY=null;}
KeyManager.prototype={processReceivedKey:function(intRecipKeyid,intSenderKeyid,mpiSenderNewY){var dhkey;if(intRecipKeyid==this.ourKeyid){this.sessKeys[1][0]=this.sessKeys[0][0];this.sessKeys[1][1]=this.sessKeys[0][1];this.ourKeyid++;this.biOurOldDhKey=this.biOurDhKey;this.mpiOurOldY=this.mpiOurY;dhkey=generateDHKey();this.biOurDhKey=dhkey.biPrivate;this.mpiOurY=dhkey.mpiPublic;if(this.mpiTheirY){this.sessKeys[0][0]=new SessionKeys(dhkey.biPrivate,dhkey.mpiPublic,this.mpiTheirY);}
if(this.mpiTheirOldY){this.sessKeys[0][1]=new SessionKeys(dhkey.biPrivate,dhkey.mpiPublic,this.mpiTheirOldY);}}
if(intSenderKeyid==this.theirKeyid){this.sessKeys[0][1]=this.sessKeys[0][0];this.sessKeys[1][1]=this.sessKeys[1][0];this.theirKeyid++;this.mpiTheirOldY=this.mpiTheirY;this.mpiTheirY=mpiSenderNewY;this.sessKeys[0][0]=new SessionKeys(this.biOurDhKey,this.mpiOurY,mpiSenderNewY);this.sessKeys[1][0]=new SessionKeys(this.biOurOldDhKey,this.mpiOurOldY,mpiSenderNewY);}},oldMacKeys:function(){return[];}};return Auth;}());